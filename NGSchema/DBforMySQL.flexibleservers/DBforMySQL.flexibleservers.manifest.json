{
    "type": "Microsoft.DBForMySQL/flexibleServers",
    "displayName": "Azure Database for MySQL Flexible Servers",
    "description": "All tables related to Azure Database for MySQL Flexible Servers.",
    "tags": {},
    "properties": {},
    "simplifiedSchemaVersion": "3",
    "icmTeam": "Azure Database for MySQL - Flexible Server / MySQL - DRI (Sev3 or below)",
    "contactDL": "mysqlinc@microsoft.com",
    "relatedTables": [
        "AzureActivity",
        "AzureDiagnostics",
        "AzureMetrics"
    ],
    "relatedFunctions": [],
    "tables": [
        {
            "name": "MySqlAuditLogs",
            "description": "Audit Logs for Azure Database for MySQL Flexible Servers.",
            "categories": [
                "audit",
                "resources"
            ],
            "tags": {},
            "properties": {},
            "artifactVersion": 6,
            "dataTypeId": "MICROSOFTORCASBREADTHSERVERS_MYSQLAUDITLOGS",
            "intelligencePacks": [
                "LogManagement"
            ],
            "isResourceCentric": true,
            "tableState": "Validation",
            "isLakeAllowed": true,
            "isTroubleshootingAllowed": true,
            "isChangeColumnInternalNameAllowed": true,
            "input": [
                {
                    "name": "location",
                    "type": "String"
                },
                {
                    "name": "Tenant",
                    "type": "String"
                },
                {
                    "name": "resourceId",
                    "type": "String"
                },
                {
                    "name": "time",
                    "type": "DateTime"
                },
                {
                    "name": "category",
                    "type": "String"
                },
                {
                    "name": "operationName",
                    "type": "String"
                },
                {
                    "name": "properties",
                    "type": "Dynamic"
                }
            ],
            "transformFilePath": "Kql/transformMSFSMySqlAuditLogs.kql",
            "columns": [
                {
                    "name": "TimeGenerated",
                    "type": "DateTime",
                    "isDefaultDisplay": true,
                    "description": "The timestamp (UTC) of when the log was generated."
                },
                {
                    "name": "EventClass",
                    "description": "Class of the log event.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "EventSubclass",
                    "description": "Subclass of the log event.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "transformName": "ConnectionId",
					"physicalName": "ConnectionId_Internal",
					"logicalName": "ConnectionId",
                    "description": "Unique connection ID generated by MySQL.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "EventTime",
                    "description": "Query start time in UTC timestamp.",
                    "type": "DateTime",
                    "isDefaultDisplay": true
                },
                {
                    "name": "ErrorCode",
                    "description": "Error code if query failed. 0 means no error.",
                    "type": "Int",
                    "isDefaultDisplay": true
                },
                {
                    "name": "ThreadId",
                    "description": "ID of thread that executed the query",
                    "type": "Int",
                    "isDefaultDisplay": true
                },
                {
                    "name": "Host",
                    "description": "Host name of client connecting to MySQL.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "Ip",
                    "description": "IP address of client connecting to MySQL.",
                    "type": "String",
                    "dataTypeHint": "IP",
                    "isDefaultDisplay": true
                },
                {
                    "name": "User",
                    "description": "Name of user executing the query.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "Db",
                    "description": "Name of database accessed.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "Table",
                    "description": "Name of table accessed.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "SqlText",
                    "description": "Full query text.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "Status",
                    "description": "Status of connection.",
                    "type": "Int",
                    "isDefaultDisplay": true
                },
                {
                    "name": "Category",
                    "description": "Category of log.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "IsAadAuth",
                    "description": "Is AAD auth or not.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "ReplicationSetRole",
                    "description": "Replication set role of MySQL flexible server.",
                    "type": "String",
                    "isDefaultDisplay": true
                }
            ],
            "sampleInputRecordsFilePath": "SampleInputRecords/MSFSMySqlAuditLogsSample.json",
            "sampleOutputRecordsFilePath": "SampleOutputRecords/MSFSMySqlAuditLogsSample.json"
        },
		{
            "name": "MySqlSlowLogs",
            "description": "Slow query Logs for Azure Database for MySQL Flexible Servers.",
            "categories": [
                "audit",
                "resources"
            ],
            "tags": {},
            "properties": {},
            "artifactVersion": 4,
            "dataTypeId": "MICROSOFTORCASBREADTHSERVERS_MYSQLSLOWLOGS",
            "intelligencePacks": [
                "LogManagement"
            ],
            "isResourceCentric": true,
            "tableState": "Validation",
            "isLakeAllowed": true,
            "isTroubleshootingAllowed": true,
            "input": [
                {
                    "name": "location",
                    "type": "String"
                },
                {
                    "name": "Tenant",
                    "type": "String"
                },
                {
                    "name": "resourceId",
                    "type": "String"
                },
                {
                    "name": "time",
                    "type": "DateTime"
                },
                {
                    "name": "category",
                    "type": "String"
                },
                {
                    "name": "operationName",
                    "type": "String"
                },
                {
                    "name": "properties",
                    "type": "Dynamic"
                }
            ],
            "transformFilePath": "Kql/transformMSFSMySqlSlowLogs.kql",
            "columns": [
                {
                    "name": "TimeGenerated",
                    "type": "DateTime",
                    "isDefaultDisplay": true,
                    "description": "The timestamp (UTC) of when the log was generated."
                },
                {
                    "name": "StartTime",
                    "description": "Query start time in UTC timestamp.",
                    "type": "DateTime",
                    "isDefaultDisplay": true
                },
                {
                    "name": "QueryDurationMs",
                    "description": "Total time in milliseconds the query took to execute.",
                    "type": "BigInt",
                    "isDefaultDisplay": true
                },
                {
                    "name": "LockDurationMs",
                    "description": "Total time in milliseconds the query was locked.",
                    "type": "BigInt",
                    "isDefaultDisplay": true
                },
                {
                    "name": "Host",
                    "description": "Host name of client connecting to MySQL.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "RowsSent",
                    "description": "Number of rows sent.",
                    "type": "Int",
                    "isDefaultDisplay": true
                },
                {
                    "name": "RowsExamined",
                    "description": "Number of rows examined.",
                    "type": "Int",
                    "isDefaultDisplay": true
                },
                {
                    "name": "LastInsertId",
                    "description": "The first automatically generated value successfully inserted for an AUTO_INCREMENT column as a result of the most recently executed INSERT statement.",
                    "type": "Int",
                    "isDefaultDisplay": true
                },
                {
                    "name": "InsertId",
                    "description": "The insert ID.",
                    "type": "Int",
                    "isDefaultDisplay": true
                },
                {
                    "name": "SqlText",
                    "description": "Full query text.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "ServerId",
                    "description": "ID of the MySQL flexible server.",
                    "type": "Int",
                    "isDefaultDisplay": true
                },
                {
                    "name": "ThreadId",
                    "description": "ID of thread that executed the query.",
                    "type": "Int",
                    "isDefaultDisplay": true
                },
                {
                    "name": "Db",
                    "description": "Name of database accessed.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "Category",
                    "description": "Category of log.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "EventClass",
                    "description": "Class of the log event.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "ReplicationSetRole",
                    "description": "Replication set role of MySQL flexible server.",
                    "type": "String",
                    "isDefaultDisplay": true
                }
            ],
            "sampleInputRecordsFilePath": "SampleInputRecords/MSFSMySqlSlowLogsSample.json",
            "sampleOutputRecordsFilePath": "SampleOutputRecords/MSFSMySqlSlowLogsSample.json"
        },
        {
            "name": "MySqlErrorLogs",
            "description": "This is error log records generated by Azure database for MySQL flexible server, similar to error log records of on-premise MySQL.",
            "categories": [
                "audit",
                "resources"
            ],
            "tags": {},
            "properties": {},
            "artifactVersion": 3,
            "dataTypeId": "MICROSOFTORCASBREADTHSERVERS_MYSQLERRORLOGS",
            "intelligencePacks": [
                "LogManagement"
            ],
            "isResourceCentric": true,
            "tableState": "Validation",
            "isTroubleshootingAllowed": true,
            "input": [
                {
                    "name": "location",
                    "type": "String"
                },
                {
                    "name": "resourceId",
                    "type": "String"
                },
                {
                    "name": "time",
                    "type": "DateTime"
                },
                {
                    "name": "category",
                    "type": "String"
                },
                {
                    "name": "operationName",
                    "type": "String"
                },
                {
                    "name": "properties",
                    "type": "String"
                }
            ],
            "transformFilePath": "Kql/transformMSFSMySqlErrorLogs.kql",
            "columns": [
                {
                    "name": "TimeGenerated",
                    "type": "DateTime",
                    "isDefaultDisplay": true,
                    "description": "The timestamp (UTC) of when the log was generated."
                },
                {
                    "name": "Message",
                    "description": "Content of error log record.",
                    "type": "String",
                    "isDefaultDisplay": true
                }
            ],
            "sampleInputRecordsFilePath": "SampleInputRecords/MSFSMySqlErrorLogsSample.json",
            "sampleOutputRecordsFilePath": "SampleOutputRecords/MSFSMySqlErrorLogsSample.json"
        }
    ],
    "queries": [
		{
			"id": "09097f08-6a4b-4747-a251-21dd4237d99a",
			"displayName": "Audit general events",
			"description": "Display all GENERAL events from the MySql Audit log.",
			"bodyFilePath": "KQL/samplekqlMSFSMySqlAuditLogs_GeneralEvents.kql",
			"categories": [
				"resources",
				"audit"
			],
			"relatedTables": [
				"MySqlAuditLogs"
			],
			"tags": {
				"Topic": [
					"Diagnostics"
				]
			},
			"properties": {
				"ExampleQuery": true
			}
		},
		{
			"id": "4fec14fe-d662-4b6f-a3a6-4a6bfcfe55cb",
			"displayName": "Audit connection events",
			"description": "Display all CONNECTION events from the MySql Audit log.",
			"bodyFilePath": "KQL/samplekqlMSFSMySqlAuditLogs_ConnectionEvents.kql",
			"categories": [
				"resources",
				"audit"
			],
			"relatedTables": [
				"MySqlAuditLogs"
			],
			"tags": {
				"Topic": [
					"Diagnostics"
				]
			},
			"properties": {
				"ExampleQuery": true
			}
		},
		{
			"id": "83c3b089-8510-4925-8614-f7f36a04af0b",
			"displayName": "Audit connection events",
			"description": "List top 5 longest queries from MySQL slow logs.",
			"bodyFilePath": "KQL/samplekqlMSFSMySqlSlowLogs_TopLongestQueries.kql",
			"categories": [
				"resources",
				"audit"
			],
			"relatedTables": [
				"MySqlSlowLogs"
			],
			"tags": {
				"Topic": [
					"Performance"
				]
			},
			"properties": {
				"ExampleQuery": true
			}
		}
    ],
    "functions": []
}
