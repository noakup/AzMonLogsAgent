{
  "type": "Microsoft.Security/Security",
  "displayName": "Microsoft Defender for Cloud",
  "description": "All tables related to Microsoft Defender for Cloud.",
  "tags": {},
  "properties": {},
  "simplifiedSchemaVersion": "3",
  "icmTeam": "Rome/Defenders",
  "contactDL": "mdcdefall@microsoft.com",
  "relatedTables": [],
  "relatedFunctions": [],

  "tables": [
    {
      "name": "SecurityAttackPathData",
      "description": "This tables contains attack paths that are being generated by Microsoft Defender for Cloud in order to detect potential breach paths of attackers to your cloud environment.",
      "categories": [
        "security"
      ],
      "intelligencePacks": [ "SecurityCenterFree", "Security", "SecurityCenter" ],
      "dataTypeId": "SECURITY_ATTACK_PATH_DATA",
      "artifactVersion": 6,
      "isResourceCentric": true,
      "tableState": "Production",
      "isLakeAllowed": true,
      "isTroubleshootingAllowed": true,
      "sampleInputRecordsFilePath": "SampleInputRecords/AttackPathInputSample.json",
      "sampleOutputRecordsFilePath": "SampleOutputRecords/AttackPathOutputSample.json",
      "input": [
        {
          "name": "exportTimestamp",
          "type": "String"
        },
        {
          "name": "subscriptionId",
          "type": "String"
        },
        {
          "name": "id",
          "type": "String"
        },
        {
          "name": "properties",
          "type": "Dynamic"
        }
      ],
      "transformFilePath": "KQL/AttackPathsTransform.kql",
      "columns": [
        {
          "name": "TimeGenerated",
          "type": "DateTime",
          "description": "The date and time the attack path was exported.",
          "isDefaultDisplay": true
        },
        {
          "name": "AttackPathId",
          "type": "String",
          "description": "The ID of the attack path.",
          "isDefaultDisplay": true,
          "isPreferredFacet": true
        },
        {
          "name": "DisplayName",
          "type": "String",
          "description": "The display name of the attack path.",
          "isDefaultDisplay": true,
          "isPreferredFacet": true
        },
        {
          "name": "Description",
          "type": "String",
          "description": "The description of the attack path.",
          "isDefaultDisplay": true,
          "isPreferredFacet": true
        },
        {
          "name": "EntrypointId",
          "type": "String",
          "dataTypeHint": "GUID",
          "description": "The ID of the attack path enry point.",
          "isDefaultDisplay": true,
          "isPreferredFacet": true
        },
        {
          "name": "TargetId",
          "type": "String",
          "dataTypeHint": "GUID",
          "description": "The ID of the attack path target.",
          "isDefaultDisplay": true,
          "isPreferredFacet": true
        },
        {
          "name": "AdditionalRemediationSteps",
          "type": "String",
          "description": "The manual remediation steps of the attack path.",
          "isDefaultDisplay": true,
          "isPreferredFacet": true
        },
        {
          "name": "Path",
          "type": "Dynamic",
          "description": "The nodes, edges & insights that create the path.",
          "isDefaultDisplay": true,
          "isPreferredFacet": true
        },
        {
          "name": "Assessments",
          "type": "Dynamic",
          "description": "The assessments mapped to the attack path.",
          "isDefaultDisplay": true,
          "isPreferredFacet": true
        },
        {
          "name": "RiskLevel",
          "type": "String",
          "description": "The risk level of the attack path.",
          "isDefaultDisplay": true,
          "isPreferredFacet": true
        },
        {
          "name": "RiskFactors",
          "type": "Dynamic",
          "description": "The risk factors of the attack path.",
          "isDefaultDisplay": true,
          "isPreferredFacet": true
        },
        {
          "name": "PotentialImpact",
          "type": "String",
          "description": "The potenrial impact of the attack path.",
          "isDefaultDisplay": true,
          "isPreferredFacet": true
        },
        {
          "name": "Mitre",
          "type": "String",
          "description": "MITRE mapping of the path.",
          "isDefaultDisplay": true,
          "isPreferredFacet": true
        },
        {
          "name": "AttackStory",
          "type": "String",
          "description": "The attack story.",
          "isDefaultDisplay": true,
          "isPreferredFacet": true
        }
      ]
    },
    {
      "name": "MDCFileIntegrityMonitoringEvents",
      "description": "View changes of Windows and Linux Files, as well as of software registry keys. Events from this table are collected by Microsoft Defender for Endpoint (MDE).",
      "categories": [
        "security"
      ],
      "dataTypeId": "SECURITY_FIM",
      "artifactVersion": 4,
      "isResourceCentric": false,
      "tableState": "Production",
      "isTroubleshootingAllowed": true,
      "isLakeAllowed": true,
      "isChangeColumnInternalNameAllowed": true,
      "input": [
        {
          "name": "TimeGenerated",
          "type": "DateTime"
        },
        {
          "name": "AzureResourceId",
          "type": "String"
        },
        {
          "name": "AADTenantID",
          "type": "String"
        },
        {
          "name": "Computer",
          "type": "String"
        },
        {
          "name": "CloudProvider",
          "type": "String"
        },
        {
          "name": "CloudIdentifier",
          "type": "String"
        },
        {
          "name": "CloudResourceType",
          "type": "String"
        },
        {
          "name": "MonitoredEntityType",
          "type": "String"
        },
        {
          "name": "ChangeType",
          "type": "String"
        },
        {
          "name": "FileName",
          "type": "String"
        },
        {
          "name": "FileType",
          "type": "String"
        },
        {
          "name": "FilePath",
          "type": "String"
        },
        {
          "name": "FileSize",
          "type": "String"
        },
        {
          "name": "OriginalFileName",
          "type": "String"
        },
        {
          "name": "OriginalFilePath",
          "type": "String"
        },
        {
          "name": "FileMd5",
          "type": "String"
        },
        {
          "name": "FileSha256",
          "type": "String"
        },
        {
          "name": "FileSha1",
          "type": "String"
        },
        {
          "name": "RequestAccountName",
          "type": "String"
        },
        {
          "name": "RequestAccountDomain",
          "type": "String"
        },
        {
          "name": "RequestAccountSid",
          "type": "String"
        },
        {
          "name": "RequestSourceIP",
          "type": "String"
        },
        {
          "name": "RequestSourcePort",
          "type": "String"
        },
        {
          "name": "RequestSource",
          "type": "String"
        },
        {
          "name": "RegistryKey",
          "type": "String"
        },
        {
          "name": "RegistryHive",
          "type": "String"
        },
        {
          "name": "OldValueData",
          "type": "String"
        },
        {
          "name": "OldValueType",
          "type": "String"
        },
        {
          "name": "OldValueName",
          "type": "String"
        },
        {
          "name": "OldValueFullRegistryKey",
          "type": "String"
        },
        {
          "name": "NewValueData",
          "type": "String"
        },
        {
          "name": "NewValueType",
          "type": "String"
        },
        {
          "name": "NewValueName",
          "type": "String"
        },
        {
          "name": "InitiatingProcessId",
          "type": "String"
        },
        {
          "name": "InitiatingProcessName",
          "type": "String"
        },
        {
          "name": "InitiatingProcessCreationTime",
          "type": "DateTime"
        },
        {
          "name": "InitiatingProcessSessionId",
          "type": "String"
        },
        {
          "name": "InitiatingProcessFirstSeen",
          "type": "DateTime"
        },
        {
          "name": "InitiatingProcessAccountSid",
          "type": "String"
        },
        {
          "name": "InitiatingProcessAccountDomainName",
          "type": "String"
        },
        {
          "name": "InitiatingProcessAccountName",
          "type": "String"
        },
        {
          "name": "InitiatingProcessImageFileName",
          "type": "String"
        },
        {
          "name": "InitiatingProcessImageFilePath",
          "type": "String"
        },
        {
          "name": "InitiatingProcessImageFileType",
          "type": "String"
        },
        {
          "name": "InitProcImageFileSizeInBytes",
          "type": "String"
        },
        {
          "name": "InitProcImageCreationTimeUtc",
          "type": "DateTime"
        },
        {
          "name": "InitProcImagePeTimestampUtc",
          "type": "DateTime"
        },
        {
          "name": "InitProcImageLastWriteTimeUtc",
          "type": "DateTime"
        },
        {
          "name": "InitProcImageLastAccessTimeUtc",
          "type": "DateTime"
        },
        {
          "name": "InitProcImageLsHash",
          "type": "String"
        },
        {
          "name": "InitProcImageMd5",
          "type": "String"
        },
        {
          "name": "InitProcImageSha256",
          "type": "String"
        },
        {
          "name": "InitProcImageSha1",
          "type": "String"
        },
        {
          "name": "InitiatingProcessSource",
          "type": "String"
        },
        {
          "name": "InitProcVersionInfoCompanyName",
          "type": "String"
        },
        {
          "name": "InitProcVersionInfoProductName",
          "type": "String"
        },
        {
          "name": "InitProcVersionInfoProductVersion",
          "type": "String"
        },
        {
          "name": "InitProcVersionInfoInternalFileName",
          "type": "String"
        },
        {
          "name": "InitProcVersionInfoOriginalFileName",
          "type": "String"
        },
        {
          "name": "InitProcVersionInfoFileDescription",
          "type": "String"
        }
      ],
      "transformFilePath": "KQL/FileIntegrityMonitoringTransform.kql",
      "columns": [
        {
          "name": "TimeGenerated",
          "type": "DateTime",
          "description": "The time (UTC) when the monitored entity was created, renamed, modified or deleted.",
          "isDefaultDisplay": true
        },
        {
          "name": "AzureResourceId",
          "type": "String",
          "description": "The Azure resource ID of the resource whose monitored entity was created, renamed, modified or deleted.",
          "isDefaultDisplay": true
        },
        {
          "name": "AADTenantID",
          "type": "String",
          "dataTypeHint": "GUID",
          "description": "The AAD tenant ID of the subscription in which the monitored entity was created, renamed, modified or deleted.",
          "isDefaultDisplay": true
        },
        {
          "name": "Computer",
          "type": "String",
          "description": "The name of the machine on which the monitored entity was created, renamed, modified or deleted.",
          "isDefaultDisplay": true
        },
        {
          "name": "CloudProvider",
          "type": "String",
          "description": "The cloud provider of the resource.",
          "isDefaultDisplay": true
        },
        {
          "name": "CloudIdentifier",
          "type": "String",
          "description": "The cloud identifier of the resource.",
          "isDefaultDisplay": true
        },
        {
          "name": "CloudResourceType",
          "type": "String",
          "description": "The type of the cloud resource.",
          "isDefaultDisplay": true
        },
        {
          "name": "MonitoredEntityType",
          "type": "String",
          "description": "The type of the monitored entity that was created, renamed, modified or deleted. Can be either 'File' or 'Registry'.",
          "isDefaultDisplay": true
        },
        {
          "name": "ChangeType",
          "type": "String",
          "description": "The type of change that occurred on the entity. For 'File' entity must be either 'Created', 'Modified', 'Renamed' or 'Deleted'. For 'Registry' entity must be either 'RegistryKeyCreated', 'RegistryKeyDeleted', 'RegistryValueSet',  'RegistryValueDeleted', 'RegistryKeyRenamed'.",
          "isDefaultDisplay": true
        },
        {
          "name": "FileName",
          "type": "String",
          "description": "Relevant for 'File' monitored entity type. Holds the name of the file that was created, renamed, modified or deleted.",
          "isDefaultDisplay": true
        },
        {
          "name": "FileType",
          "type": "String",
          "description": "Relevant for 'File' monitored entity type. Holds the type of the file that was created, renamed, modified or deleted. Example of possible values: Zip, PDF, Xar etc.",
          "isDefaultDisplay": true
        },
        {
          "name": "FilePath",
          "type": "String",
          "dataTypeHint": "URI",
          "description": "Relevant for 'File' monitored entity type. Holds the path of the file that was created, renamed, modified or deleted.",
          "isDefaultDisplay": true
        },
        {
          "name": "FileSize",
          "type": "BigInt",
          "description": "Relevant for 'File' monitored entity type. Holds the current size (in bytes) of the file that was created, renamed, modified or deleted.",
          "isDefaultDisplay": true
        },
        {
          "name": "OriginalFileName",
          "type": "String",
          "description": "Relevant for 'File' monitored entity type and for a 'Rename' change type. Holds the original name the file that was renamed, before the  rename occured.",
          "isDefaultDisplay": true
        },
        {
          "name": "OriginalFilePath",
          "type": "String",
          "dataTypeHint": "URI",
          "description": "Relevant for 'File' monitored entity type and for a 'Rename' change type. Holds the original path of the file that was renamed, before the  rename occured.",
          "isDefaultDisplay": true
        },
        {
          "name": "FileMd5",
          "type": "String",
          "description": "Relevant for 'File' monitored entity type. Holds the MD5 of the file that was modified, created or deleted.",
          "isDefaultDisplay": true
        },
        {
          "name": "FileSha256",
          "type": "String",
          "description": "Relevant for 'File' monitored entity type. Holds the SHA256 of the file that was modified, created or deleted.",
          "isDefaultDisplay": true
        },
        {
          "name": "FileSha1",
          "type": "String",
          "description": "Relevant for 'File' monitored entity type. Holds the SHA1 of the file that was modified, created or deleted.",
          "isDefaultDisplay": true
        },
        {
          "name": "RequestAccountName",
          "type": "String",
          "description": "Relevant for 'File' monitored entity type. Holds the name of the account of the user that caused the file event.",
          "isDefaultDisplay": true
        },
        {
          "name": "RequestAccountDomain",
          "type": "String",
          "description": "Relevant for 'File' monitored entity type. Holds the domain of the account of the user that caused the file event."
        },
        {
          "name": "RequestAccountSid",
          "type": "String",
          "description": "Relevant for 'File' monitored entity type. Holds the SID of the account of the user that caused the file event."
        },
        {
          "name": "RequestSourceIP",
          "type": "String",
          "description": "Relevant for 'File' monitored entity type. Holds the source IP of the account of the user that caused the file event. For remote file, the IP from which the request came."
        },
        {
          "name": "RequestSourcePort",
          "type": "String",
          "description": "Relevant for 'File' monitored entity type. Holds the source port of the account of the user that caused the file event. For remote file, the port from which the request came."
        },
        {
          "name": "RequestSource",
          "type": "String",
          "description": "Relevant for 'File' monitored entity type. Holds the source of the account of the user that caused the file event. For example Local/SMB/NFS."
        },
        {
          "name": "RegistryKey",
          "type": "String",
          "description": "Relevant for 'Registry' monitored entity type. Holds the full registry key of the registry that was created or the new registry key of the registry that was renamed.",
          "isDefaultDisplay": true
        },
        {
          "name": "RegistryHive",
          "type": "String",
          "description": "Relevant for 'Registry' monitored entity type. Holds the grouping configuration settings for the operating system and applications.",
          "isDefaultDisplay": true
        },
        {
          "name": "OldValueData",
          "type": "String",
          "description": "Relevant for 'Registry' monitored entity type. Holds the previous registry value data.",
          "isDefaultDisplay": true
        },
        {
          "name": "OldValueType",
          "type": "String",
          "description": "Relevant for 'Registry' monitored entity type. Holds the previous registry value type.",
          "isDefaultDisplay": true
        },
        {
          "name": "OldValueName",
          "type": "String",
          "description": "Relevant for 'Registry' monitored entity type. Holds the previous registry value name.",
          "isDefaultDisplay": true
        },
        {
          "name": "OldValueFullRegistryKey",
          "type": "String",
          "description": "Relevant for 'Registry' monitored entity type. Holds the previous full registry key.",
          "isDefaultDisplay": true
        },
        {
          "name": "NewValueData",
          "type": "String",
          "description": "Relevant for 'Registry' monitored entity type. Holds the New registry value data.",
          "isDefaultDisplay": true
        },
        {
          "name": "NewValueType",
          "type": "String",
          "description": "Relevant for 'Registry' monitored entity type. Holds the New registry value type.",
          "isDefaultDisplay": true
        },
        {
          "name": "NewValueName",
          "type": "String",
          "description": "Relevant for 'Registry' monitored entity type. Holds the New registry value name.",
          "isDefaultDisplay": true
        },
        {
          "name": "InitiatingProcessId",
          "type": "BigInt",
          "description": "Holds the process Id of the initiating process that caused the monitored entity event."
        },
        {
          "transformName": "InitiatingProcessName",
          "physicalName": "InitiatingProcessName_Internal",
          "logicalName": "InitiatingProcessName",
          "type": "String",
          "description": "Holds the name of the initiating process that caused the monitored entity event.",
          "isDefaultDisplay": true
        },
        {
          "name": "InitiatingProcessCreationTime",
          "type": "DateTime",
          "description": "Holds the creation time of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitiatingProcessSessionId",
          "type": "BigInt",
          "description": "Holds the session Id of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitiatingProcessFirstSeen",
          "type": "DateTime",
          "description": "Holds the first seen time of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitiatingProcessAccountSid",
          "type": "String",
          "description": "Holds the account SID of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitiatingProcessAccountDomainName",
          "type": "String",
          "description": "Holds the account domain name of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitiatingProcessAccountName",
          "type": "String",
          "description": "Holds the account name of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitiatingProcessImageFileName",
          "type": "String",
          "description": "Holds the image file name of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitiatingProcessImageFilePath",
          "type": "String",
          "description": "Holds the image file path of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitiatingProcessImageFileType",
          "type": "String",
          "description": "Holds the image file type of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcImageFileSizeInBytes",
          "type": "BigInt",
          "description": "Holds the image file size (in Bytes) of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcImageCreationTimeUtc",
          "type": "DateTime",
          "description": "Holds the image creation time for the image of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcImagePeTimestampUtc",
          "type": "DateTime",
          "description": "Holds the image PE time for the image of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcImageLastWriteTimeUtc",
          "type": "DateTime",
          "description": "Holds the image last write time for the image of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcImageLastAccessTimeUtc",
          "type": "DateTime",
          "description": "Holds the image last access time for the image of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcImageLsHash",
          "type": "String",
          "description": "Holds the image LS hash for the image of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcImageMd5",
          "type": "String",
          "description": "Holds the image MD5 for the image of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcImageSha256",
          "type": "String",
          "description": "Holds the image SHA 256 for the image of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcImageSha1",
          "type": "String",
          "description": "Holds the image SHA 1 for the image of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitiatingProcessSource",
          "type": "String",
          "description": "Holds the source of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcVersionInfoCompanyName",
          "type": "String",
          "description": "Holds the version info company name of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcVersionInfoProductName",
          "type": "String",
          "description": "Holds the version info product name of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcVersionInfoProductVersion",
          "type": "String",
          "description": "Holds the version info product version of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcVersionInfoInternalFileName",
          "type": "String",
          "description": "Holds the version info internal file name of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcVersionInfoOriginalFileName",
          "type": "String",
          "description": "Holds the version info original file name of the initiating process that caused the monitored entity event."
        },
        {
          "name": "InitProcVersionInfoFileDescription",
          "type": "String",
          "description": "Holds the version info file description of the initiating process that caused the monitored entity event."
        }
      ],
      "sampleInputRecordsFilePath": "SampleInputRecords/FileIntegrityMonitoringSample.json",
      "sampleOutputRecordsFilePath": "SampleOutputRecords/FileIntegrityMonitoringSample.json"
    }
  ],

  "functions": [],

  "queries": [
    {
      "id": "bdb7da24-8f5f-422d-927e-14b06c75a407",
      "displayName": "All attack paths by specific risk level",
      "description": "Get all attack paths with a specific risk level such as: Critical, High, Medium, and Low.",
      "bodyFilePath": "KQL/AttachPathsByRiskLevelQuery.kql",
      "categories": [ "security" ],
      "relatedTables": [
        "SecurityAttackPathData"
      ],
      "tags": {},
      "properties": {
        "ExampleQuery": true
      }
    },
    {
      "id": "5a1c1fd7-a9c7-428a-a804-64d0b46d1c18",
      "displayName": "All file integrity monitoring events by specific monitored entity type",
      "description": "Get all file integrity monitoring events with a specific monitored entity type such as: File or Registry.",
      "bodyFilePath": "KQL/FileIntegrityMonitoringEventsByMonitoredEntityType.kql",
      "categories": [ "security" ],
      "relatedTables": [
        "FileIntegrityMonitoringEvents"
      ],
      "tags": {},
      "properties": {
        "ExampleQuery": true
      }
    }
  ]
}