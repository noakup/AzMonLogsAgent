source
| extend ipPermissionsFirstItem = requestParameters["ipPermissions"]["items"][0]
| project
    TimeGenerated = todatetime(eventTime),
    AwsEventId = toguid(eventID),
    EventVersion = tostring(eventVersion),
    EventSource = tostring(eventSource),
    EventTypeName = tostring(eventType),
    EventName = tostring(eventName),
    UserIdentityType = tostring(userIdentity.type),
    UserIdentityPrincipalid = tostring(userIdentity.principalId),
    UserIdentityArn = tostring(userIdentity.arn),
    UserIdentityAccountId = tostring(userIdentity.accountId),
    UserIdentityInvokedBy = tostring(userIdentity.invokedBy),
    UserIdentityAccessKeyId = tostring(userIdentity.accessKeyId),
    UserIdentityUserName = tostring(userIdentity.userName),
    SessionMfaAuthenticated = tobool(userIdentity.sessionContext.attributes.mfaAuthenticated),
    SessionCreationDate = todatetime(userIdentity.sessionContext.attributes.creationDate),
    SessionIssuerType = tostring(userIdentity.sessionContext.sessionIssuer.type),
    SessionIssuerPrincipalId = tostring(userIdentity.sessionContext.sessionIssuer.principalId),
    SessionIssuerArn = tostring(userIdentity.sessionContext.sessionIssuer.arn),
    SessionIssuerAccountId = tostring(userIdentity.sessionContext.sessionIssuer.accountId),
    SessionIssuerUserName = tostring(userIdentity.sessionContext.sessionIssuer.userName),
    EC2RoleDelivery = tostring(userIdentity.sessionContext.ec2RoleDelivery),
    AWSRegion = tostring(awsRegion),
    SourceIpAddress = tostring(sourceIPAddress),
    UserAgent = tostring(userAgent),
    ErrorCode = tostring(errorCode),
    ErrorMessage = tostring(errorMessage),
    RequestParameters = tostring(requestParameters),
    IpProtocol = tostring(ipPermissionsFirstItem.ipProtocol),
    SourcePort = tostring(ipPermissionsFirstItem.fromPort),
    DestinationPort = tostring(ipPermissionsFirstItem.toPort),
    CidrIp = tostring(ipPermissionsFirstItem.ipRanges.items[0].cidrIp),
    ResponseElements = tostring(responseElements),
    AdditionalEventData = tostring(additionalEventData),
    AwsRequestId = guid(null),
    AwsRequestId_ = tostring(requestID),
    Resources = tostring(resources),
    APIVersion = tostring(apiVersion),
    ReadOnly = tobool(readOnly),
    RecipientAccountId = tostring(recipientAccountId),
    ServiceEventDetails = tostring(serviceEventDetails),
    SharedEventId = toguid(sharedEventID),
    VpcEndpointId = tostring(vpcEndpointId),
    ManagementEvent = tobool(managementEvent),
    TlsVersion = tostring(tlsDetails.tlsVersion),
    CipherSuite = tostring(tlsDetails.cipherSuite),
    ClientProvidedHostHeader = tostring(tlsDetails.clientProvidedHostHeader),
    SourceSystem = "",
    OperationName = "",
    Category = ""

    