source 
| where logName has 'container.googleapis.com%2Fapiserver' 
| extend 
    TimeGenerated = timestamp, 
    InsertId = tostring(insertId), 
    LogName = tostring(logName), 
    Labels = todynamic(labels), 
    Message = tostring(jsonPayload.message), 
    Pid = tostring(jsonPayload.pid), 
    Severity = tostring(severity), 
    SourceFile = iff(isnotempty(todynamic(sourceLocation)), tostring(sourceLocation.file), ''), 
    SourceLine = iff(isnotempty(todynamic(sourceLocation)), tostring(sourceLocation.line), ''), 
    ReceiveTimestamp = receiveTimestamp, 
    ClusterName = tostring(resource.labels.cluster_name), 
    ComponentLocation = tostring(resource.labels.component_location), 
    ComponentName = tostring(resource.labels.component_name), 
    Location = tostring(resource.labels.location), 
    ProjectID = tostring(resource.labels.project_id), 
    ComputeResourceName = tostring(labels['compute.googleapis.com/resource_name']) 
| extend 
    Protocol = iff(Message startswith @'\"HTTP\"', 'HTTP', ''), 
    HttpVerb = extract(@'verb=\\\"(\\w+)\\\"', 1, Message), 
    URI = extract(@'URI=\\\"([^\\\"]+)\\\"', 1, Message), 
    Latency = extract(@'latency=\\\"([^\\\"]+)\\\"', 1, Message), 
    UserAgent = extract(@'userAgent=\\\"([^\\\"]+)\\\"', 1, Message), 
    AuditID = extract(@'audit-ID=\\\"([^\\\"]*)\\\"', 1, Message), 
    SrcIP = extract(@'srcIP=\\\"([^\\\"]+)\\\"', 1, Message), 
    ResponseCode = toint(extract(@'resp=(\\d+)', 1, Message)), 
    ApfPl = extract(@'apf_pl=\\\"([^\\\"]+)\\\"', 1, Message), 
    ApfFs = extract(@'apf_fs=\\\"([^\\\"]+)\\\"', 1, Message), 
    ApfISeats = toint(extract(@'apf_iseats=(\\d+)', 1, Message)), 
    ApfFSeats = toint(extract(@'apf_fseats=(\\d+)', 1, Message)), 
    ApfAdditionalLatency = extract(@'apf_additionalLatency=\\\"([^\\\"]+)\\\"', 1, Message), 
    ApfExecutionTime = extract(@'apf_execution_time=\\\"([^\\\"]+)\\\"', 1, Message) 
| project 
    TimeGenerated, 
    InsertId, 
    LogName, 
    Labels, 
    Message, 
    Pid, 
    Severity, 
    SourceFile, 
    SourceLine, 
    ReceiveTimestamp, 
    ClusterName, 
    ComponentLocation, 
    ComponentName, 
    Location, 
    ProjectID, 
    ComputeResourceName, 
    Protocol, 
    HttpVerb, 
    URI, 
    Latency, 
    UserAgent, 
    AuditID, 
    SrcIP, 
    ResponseCode, 
    ApfPl, 
    ApfFs, 
    ApfISeats, 
    ApfFSeats, 
    ApfAdditionalLatency, 
    ApfExecutionTime