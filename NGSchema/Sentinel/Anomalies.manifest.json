{
  "type": "Microsoft.SecurityInsights/Anomalies",
  "displayName": "Azure Sentinel Anomaly Table",
  "description": "Anomalies generated by Azure Sentinel Anomaly analytics rules.",
  "tags": {},
  "properties": {},
  "simplifiedSchemaVersion": "3",
  "icmTeam": "SIPS API",
  "relatedTables": [],
  "relatedFunctions": [],
  "tables": [
    {
      "name": "Anomalies",
      "description": "This table contains anomalies generated by the active Anomaly analytics rules in Azure Sentinel.",
      "artifactVersion": 7,
      "categories": [ "security" ],
      "tags": {},
      "properties": {},
      "dataTypeId": "SENTINEL_ANOMALIES",
      "intelligencePacks": [ "SecurityInsights" ],
      "isResourceCentric": false,
      "isChangeColumnInternalNameAllowed": true,
      "tableState": "Production",
      "isTroubleshootingAllowed": true,
      "isLakeAllowed": true,
      "input": [
        {
          "name": "Id",
          "type": "String"
        },
        {
          "name": "WorkspaceId",
          "type": "String"
        },
        {
          "name": "VendorName",
          "type": "String"
        },
        {
          "name": "TimeGenerated",
          "type": "DateTime"
        },
        {
          "name": "AnomalyTemplateId",
          "type": "String"
        },
        {
          "name": "AnomalyTemplateName",
          "type": "String"
        },
        {
          "name": "AnomalyTemplateVersion",
          "type": "String"
        },
        {
          "name": "RuleId",
          "type": "String"
        },
        {
          "name": "RuleStatus",
          "type": "String"
        },
        {
          "name": "RuleName",
          "type": "String"
        },
        {
          "name": "RuleConfigVersion",
          "type": "String"
        },
        {
          "name": "Score",
          "type": "Double"
        },
        {
          "name": "Description",
          "type": "String"
        },
        {
          "name": "StartTime",
          "type": "DateTime"
        },
        {
          "name": "EndTime",
          "type": "DateTime"
        },
        {
          "name": "ExtendedLinks",
          "type": "String"
        },
        {
          "name": "Tactics",
          "type": "String"
        },
        {
          "name": "Techniques",
          "type": "String"
        },
        {
          "name": "UserName",
          "type": "String"
        },
        {
          "name": "UserPrincipalName",
          "type": "String"
        },
        {
          "name": "SourceIpAddress",
          "type": "String"
        },
        {
          "name": "SourceLocation",
          "type": "String"
        },
        {
          "name": "SourceDevice",
          "type": "String"
        },
        {
          "name": "DestinationIpAddress",
          "type": "String"
        },
        {
          "name": "DestinationLocation",
          "type": "String"
        },
        {
          "name": "DestinationDevice",
          "type": "String"
        },
        {
          "name": "ActivityInsights",
          "type": "String"
        },
        {
          "name": "DeviceInsights",
          "type": "String"
        },
        {
          "name": "UserInsights",
          "type": "String"
        },
        {
          "name": "AnomalyReasons",
          "type": "String"
        },
        {
          "name": "Entities",
          "type": "String"
        },
        {
          "name": "ExtendedProperties",
          "type": "String"
        },
        {
          "name": "AnomalyDetails",
          "type": "String"
        }
      ],
      "transformFilePath": "Kql/AnomaliesTransform.kql",
      "columns": [
        {
          "name": "Id",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The ID of the generated anomaly.",
          "dataTypeHint": "GUID"
        },
        {
          "name": "WorkspaceId",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The ID of the Sentinel workspace.",
          "dataTypeHint": "GUID"
        },
        {
          "name": "VendorName",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The name of the vendor that generated this anomaly."
        },
        {
          "name": "TimeGenerated",
          "type": "DateTime",
          "isDefaultDisplay": true,
          "description": "The timestamp (UTC) of when the anomaly was generated."
        },
        {
          "name": "AnomalyTemplateId",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The ID of the Anomaly template that generated this anomaly.",
          "dataTypeHint": "GUID"
        },
        {
          "name": "AnomalyTemplateName",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The name of the Anomaly template that generated this anomaly."
        },
        {
          "name": "AnomalyTemplateVersion",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The version of the Anomaly template that generated this anomaly."
        },
        {
          "name": "RuleId",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The ID of the Anomaly analytics rule that generated this anomaly.",
          "dataTypeHint": "GUID"
        },
        {
          "name": "RuleStatus",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The status (Flighting/Production) of the Anomaly analytics rule that generated this anomaly."
        },
        {
          "name": "RuleName",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The name of the Anomaly analytics rule that generated this anomaly."
        },
        {
          "name": "RuleConfigVersion",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The configuration version of the Anomaly analytics rule that generated this anomaly."
        },
        {
          "name": "Score",
          "type": "Double",
          "isDefaultDisplay": true,
          "description": "The score of the anomaly."
        },
        {
          "name": "Description",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The description of the anomaly."
        },
        {
          "name": "StartTime",
          "type": "DateTime",
          "isDefaultDisplay": true,
          "description": "The time (UTC) when the anomaly started."
        },
        {
          "name": "EndTime",
          "type": "DateTime",
          "isDefaultDisplay": true,
          "description": "The time (UTC) when the anomaly ended."
        },
        {
          "transformName": "ExtendedLinks",
          "physicalName": "ExtendedLinks_Internal",
          "logicalName": "ExtendedLinks",
          "type": "Dynamic",
          "isDefaultDisplay": true,
          "description": "List of links pointing to the data that generated the anomaly."
        },
        {
          "name": "Tactics",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "List of MITRE ATT&CK tactics (strings) corresponding to the anomaly."
        },
        {
          "name": "Techniques",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "List MITRE ATT&CK techniques (strings) corresponding to the anomaly."
        },
        {
          "name": "UserName",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The username for which the anomaly was generated."
        },
        {
          "name": "UserPrincipalName",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The UPN of the user for which the anomaly was generated."
        },
        {
          "name": "SourceIpAddress",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The source ip address for which the anomaly was generated."
        },
        {
          "name": "SourceLocation",
          "type": "Dynamic",
          "isDefaultDisplay": true,
          "description": "Info about the source location for which the anomaly was generated as JSON."
        },
        {
          "name": "SourceDevice",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The source device for which the anomaly was generated."
        },
        {
          "name": "DestinationIpAddress",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The destination ip address for which the anomaly was generated."
        },
        {
          "name": "DestinationLocation",
          "type": "Dynamic",
          "isDefaultDisplay": true,
          "description": "Info about the destination location for which the anomaly was generated as JSON."
        },
        {
          "name": "DestinationDevice",
          "type": "String",
          "isDefaultDisplay": true,
          "description": "The destination device for which the anomaly was generated."
        },
        {
          "name": "ActivityInsights",
          "type": "Dynamic",
          "isDefaultDisplay": true,
          "description": "Insights about the activites corresponding to the generated anomaly as JSON."
        },
        {
          "name": "DeviceInsights",
          "type": "Dynamic",
          "isDefaultDisplay": true,
          "description": "Insights about the devices corresponding to the generated anomaly as JSON."
        },
        {
          "name": "UserInsights",
          "type": "Dynamic",
          "isDefaultDisplay": true,
          "description": "Insights about the users corresponding to the generated anomaly as JSON."
        },
        {
          "name": "AnomalyReasons",
          "type": "Dynamic",
          "isDefaultDisplay": true,
          "description": "The detailed explanation of the generated anomaly as JSON."
        },
        {
          "name": "Entities",
          "type": "Dynamic",
          "isDefaultDisplay": true,
          "description": "JSON object containing all entities involved in the generated anomaly."
        },
        {
          "name": "ExtendedProperties",
          "type": "Dynamic",
          "isDefaultDisplay": true,
          "description": "JSON object with additional data on the anomaly as key-value pairs."
        },
        {
          "name": "AnomalyDetails",
          "type": "Dynamic",
          "isDefaultDisplay": true,
          "description": "JSON object containing general information about the rule and algorithm that generated the anomaly as well as explanations for the anomaly."
        }
      ],
      "sampleInputRecordsFilePath": "SampleInputRecords/AnomaliesSample.json"
    }
  ],
  "functions":[],
  "queries":
  [
    {
      "id": "d343d7e2-9407-485a-96e5-8fb5d0031ee2",
      "displayName": "Get Production Anomalies (last day)",
      "description": "Gets a list of all anomalies generated by a production Sentinel rule in the last day",
      "bodyFilePath": "KQL/GetProductionAnomaliesQuery.kql",
      "categories": [ "security" ],
      "relatedTables": [ "Anomalies" ],
      "properties": {
        "ExampleQuery": true
      }
    },
    {
      "id": "650380ee-8027-4dc3-8763-c338222be64a",
      "displayName": "Get Flighting Anomalies (last day)",
      "description": "Gets a list of all anomalies generated by a flighting Sentinel rule in the last day",
      "bodyFilePath": "KQL/GetFlightingAnomaliesQuery.kql",
      "categories": [ "security" ],
      "relatedTables": [ "Anomalies" ],
      "properties": {
        "ExampleQuery": true
      }
    }
  ]
}
