{
  "type": "Microsoft.App/managedEnvironments",
  "displayName": "Container Apps",
  "description": "Logs for Azure Container Apps Environments configured with Azure Monitor support. Logs pushed to this Log Analytics resource originate from Shoebox Logs.",
  "simplifiedSchemaVersion": "3",
  "icmTeam": "Azure Container Apps/Azure Container Apps Loop",
  "tags": {},
  "contactDL": "cacore@microsoft.com",
  "properties": {},
  "relatedTables": ["AzureActivity"],
  "tables": [
    {
      "name": "ContainerAppConsoleLogs",
      "description": "Logs generated by Container Apps within a Container App Environment. This includes logs generated on the stdout or stderr streams by all containers in the app. It also includes all Dapr sidecar container logs but does not include any system or platform level logs produced by the Container App Environment itself.",
      "categories": ["audit", "resources"],
      "dataTypeId": "MICROSOFTAPP_CONTAINERAPPCONSOLELOGS",
      "artifactVersion": 3,
      "isResourceCentric": true,
      "tableState": "Production",
      "tags": {},
      "properties": {},
      "isTroubleshootingAllowed": true,
      "isLakeAllowed": true,
      "intelligencePacks": ["LogManagement"],
      "input": [
        {
          "name": "time",
          "type": "DateTime"
        },
        {
          "name": "operationName",
          "type": "String"
        },
        {
          "name": "category",
          "type": "String"
        },
        {
          "name": "properties",
          "type": "Dynamic"
        },
        {
          "name": "location",
          "type": "String"
        }
      ],
      "transformFilePath": "KQL/ContainerAppConsoleLogs.kql",
      "columns": [
        {
          "name": "TimeGenerated",
          "description": "Time (UTC) when the log was generated.",
          "type": "DateTime",
          "isDefaultDisplay": true
        },
        {
          "name": "OperationName",
          "description": "The name of the operation generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Location",
          "description": "The location of the Container App generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerName",
          "description": "The name of the container generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerGroupName",
          "description": "The name of the container's pod (Container App replica) generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerImage",
          "description": "The image used in the container instance that generated this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Stream",
          "description": "The stream where the log was emitted.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerGroupId",
          "description": "The ID of the container's pod (Container App replica) generating this log.",
          "type": "String",
          "isDefaultDisplay": true,
          "dataTypeHint": "GUID"
        },
        {
          "name": "EnvironmentName",
          "description": "The name of the Container App Environment generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Log",
          "description": "The log generated by the user's Container App.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerAppName",
          "description": "The name of the Container App generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerId",
          "description": "The ID of the Container App generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "RevisionName",
          "description": "The name of the revision generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "JobName",
          "description": "The name of the kubernetes job running inside a managed AKS environment generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        }
      ],
      "sampleInputRecordsFilePath": "SampleInputRecords/ContainerAppConsoleLogs.json",
      "sampleOutputRecordsFilePath": "SampleOutputRecords/ContainerAppConsoleLogs.json"
    },
    {
      "name": "ContainerAppSystemLogs",
      "description": "Platform Logs generated by a Container App Environment. These logs are generated by system components and any underlying infrastructure. Events related to revision management, Dapr, Keda and Envoy can be found here.",
      "categories": ["audit", "resources"],
      "dataTypeId": "MICROSOFTAPP_CONTAINERAPPSYSTEMLOGS",
      "artifactVersion": 3,
      "isResourceCentric": true,
      "tableState": "Production",
      "tags": {},
      "properties": {},
      "isTroubleshootingAllowed": false,
      "intelligencePacks": ["LogManagement"],
      "input": [
        {
          "name": "time",
          "type": "DateTime"
        },
        {
          "name": "operationName",
          "type": "String"
        },
        {
          "name": "category",
          "type": "String"
        },
        {
          "name": "properties",
          "type": "Dynamic"
        },
        {
          "name": "location",
          "type": "String"
        }
      ],
      "transformFilePath": "KQL/ContainerAppSystemLogs.kql",
      "columns": [
        {
          "name": "TimeGenerated",
          "description": "Time (UTC) when the log was generated.",
          "type": "DateTime",
          "isDefaultDisplay": true
        },
        {
          "name": "OperationName",
          "description": "The name of the operation generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Location",
          "description": "The location of the Container App generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerName",
          "description": "The name of the container generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "EnvironmentName",
          "description": "The name of the Container App Environment generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Log",
          "description": "The log generated by the Container App Environment.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "RevisionName",
          "description": "The name of the revision generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Type",
          "description": "For events emitted by the Container App Environment. Type indicates the severity level of the event.",
          "type": "String",
          "isDefaultDisplay": false
        },
        {
          "name": "ContainerAppName",
          "description": "The name of Container App generating this log.",
          "type": "String",
          "isDefaultDisplay": false
        },
        {
          "name": "ReplicaName",
          "description": "The name of Container App replica generating this log.",
          "type": "String",
          "isDefaultDisplay": false
        },
        {
          "name": "Reason",
          "description": "The reason why this event was generated.",
          "type": "String",
          "isDefaultDisplay": false
        },
        {
          "name": "EventSource",
          "description": "The name of project generating this log. This includes but is not limited to systems components in the Container App Environments or open source integrations such as Keda or Dapr.",
          "type": "String",
          "isDefaultDisplay": false
        },
        {
          "name": "Count",
          "description": "How many times this log has been seen.",
          "type": "Int",
          "isDefaultDisplay": false
        },
        {
          "name": "JobName",
          "description": "The name of the Job generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ComponentName",
          "description": "The name of component name.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ComponentType",
          "description": "The type of component such as SpringCloudConfig, SpringCloudEureka, etc.",
          "type": "String",
          "isDefaultDisplay": true
        }
      ],
      "sampleInputRecordsFilePath": "SampleInputRecords/ContainerAppSystemLogs.json",
      "sampleOutputRecordsFilePath": "SampleOutputRecords/ContainerAppSystemLogs.json"
    },
    {
      "name": "AppEnvSpringAppConsoleLogs",
      "description": "Logs generated by Spring Apps(Container Apps with managedBy annotation) within a Container App Environment. This includes logs generated on the stdout or stderr streams by all containers in the app. It also includes all Dapr sidecar container logs but does not include any system or platform level logs produced by the Container App Environment itself.",
      "categories": ["audit", "resources"],
      "dataTypeId": "MICROSOFTAPP_APPENVSPRINGAPPCONSOLELOGS",
      "artifactVersion": 2,
      "isResourceCentric": true,
      "tableState": "Production",
      "tags": {},
      "properties": {},
      "isLakeAllowed": true,
      "isTroubleshootingAllowed": true,
      "intelligencePacks": ["LogManagement"],
      "input": [
        {
          "name": "time",
          "type": "DateTime"
        },
        {
          "name": "operationName",
          "type": "String"
        },
        {
          "name": "category",
          "type": "String"
        },
        {
          "name": "properties",
          "type": "Dynamic"
        },
        {
          "name": "location",
          "type": "String"
        }
      ],
      "transformFilePath": "KQL/AppEnvSpringAppConsoleLogs.kql",
      "columns": [
        {
          "name": "TimeGenerated",
          "description": "Time (UTC) when the log was generated.",
          "type": "DateTime",
          "isDefaultDisplay": true
        },
        {
          "name": "OperationName",
          "description": "The name of the operation generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Location",
          "description": "The location of the Container App generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerName",
          "description": "The name of the container generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerGroupName",
          "description": "The name of the container's pod (Container App replica) generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerImage",
          "description": "The image used in the container instance that generated this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Stream",
          "description": "The stream where the log was emitted.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerGroupId",
          "description": "The ID of the container's pod (Container App replica) generating this log.",
          "type": "String",
          "isDefaultDisplay": true,
          "dataTypeHint": "GUID"
        },
        {
          "name": "EnvironmentName",
          "description": "The name of the Container App Environment generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Log",
          "description": "The log message generated by the user's Container App.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerAppName",
          "description": "The name of the Container App generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerId",
          "description": "The ID of the Container App generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "RevisionName",
          "description": "The name of the revision generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        }
      ],
      "sampleInputRecordsFilePath": "SampleInputRecords/AppEnvSpringAppConsoleLogs.json",
      "sampleOutputRecordsFilePath": "SampleOutputRecords/AppEnvSpringAppConsoleLogs.json"
    },
    {
      "name": "AppEnvSessionConsoleLogs",
      "description": "Logs generated by Sessions within a Container App Environment. This includes logs generated on the stdout or stderr streams by all containers in the session.",
      "categories": [
        "audit",
        "resources"
      ],
      "dataTypeId": "MICROSOFTAPP_APPENVSESSIONCONSOLELOGS",
      "artifactVersion": 2,
      "isResourceCentric": true,
      "tableState": "Production",
      "tags": {},
      "properties": {},
      "isLakeAllowed": true,
      "isTroubleshootingAllowed": true,
      "intelligencePacks": [
        "LogManagement"
      ],
      "input": [
        {
          "name": "time",
          "type": "DateTime"
        },
        {
          "name": "operationName",
          "type": "String"
        },
        {
          "name": "category",
          "type": "String"
        },
        {
          "name": "properties",
          "type": "Dynamic"
        },
        {
          "name": "location",
          "type": "String"
        }
      ],
      "transformFilePath": "KQL/AppEnvSessionConsoleLogs.kql",
      "columns": [
        {
          "name": "TimeGenerated",
          "description": "Time (UTC) when the log was generated.",
          "type": "DateTime",
          "isDefaultDisplay": true
        },
        {
          "name": "OperationName",
          "description": "The name of the operation generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Location",
          "description": "The location of the session generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Log",
          "description": "The log generated by the user's session.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Stream",
          "description": "The stream where the log was emitted.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "SessionPoolName",
          "description": "The name of the Session Pool generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "SessionIdentifier",
          "description": "The identifier of the session generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "EnvironmentName",
          "description": "The name of the Container App Environment generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerName",
          "description": "The name of the container generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerId",
          "description": "The ID of the session generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerGroupName",
          "description": "The name of the session's pod generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "ContainerGroupId",
          "description": "The ID of the session's pod generating this log.",
          "type": "String",
          "isDefaultDisplay": true,
          "dataTypeHint": "GUID"
        },
        {
          "name": "ContainerImage",
          "description": "The image used in the container instance that generated this log.",
          "type": "String",
          "isDefaultDisplay": true
        }
      ],
      "sampleInputRecordsFilePath": "SampleInputRecords/AppEnvSessionConsoleLogs.json",
      "sampleOutputRecordsFilePath": "SampleOutputRecords/AppEnvSessionConsoleLogs.json"
    },
    {
      "name": "AppEnvSessionPoolEventLogs",
      "description": "Logs generated by CustomContainer Session Pool within a Container App Environment. This includes logs produced by the Session Pool itself, including pod creation and deletion, etc",
      "categories": [
        "audit",
        "resources"
      ],
      "dataTypeId": "MICROSOFTAPP_APPENVSESSIONPOOLEVENTLOGS",
      "artifactVersion": 2,
      "isResourceCentric": true,
      "tableState": "Production",
      "tags": {},
      "properties": {},
      "isLakeAllowed": true,
      "isTroubleshootingAllowed": true,
      "intelligencePacks": [
        "LogManagement"
      ],
      "input": [
        {
          "name": "time",
          "type": "DateTime"
        },
        {
          "name": "operationName",
          "type": "String"
        },
        {
          "name": "category",
          "type": "String"
        },
        {
          "name": "properties",
          "type": "Dynamic"
        },
        {
          "name": "location",
          "type": "String"
        }
      ],
      "transformFilePath": "KQL/AppEnvSessionPoolEventLogs.kql",
      "columns": [
        {
          "name": "TimeGenerated",
          "description": "Time (UTC) when the log was generated.",
          "type": "DateTime",
          "isDefaultDisplay": true
        },
        {
          "name": "OperationName",
          "description": "The name of the operation generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Location",
          "description": "The location of the Session Pool generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "SessionPoolName",
          "description": "The name of the Session Pool generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "PodName",
          "description": "The name of the session's pod generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "NodeName",
          "description": "The name of the node instance that generated this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Level",
          "description": "The log level of the log. This can be Info, Error, etc.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Log",
          "description": "The log generated by the Session Pool.",
          "type": "String",
          "isDefaultDisplay": true
        }
      ],
      "sampleInputRecordsFilePath": "SampleInputRecords/AppEnvSessionPoolEventLogs.json",
      "sampleOutputRecordsFilePath": "SampleOutputRecords/AppEnvSessionPoolEventLogs.json"
    },
    {
      "name": "AppEnvSessionLifecycleLogs",
      "description": "Logs generated by CustomContainer Session Pool within a Container App Environment. This includes logs produced by session allocation related platform events.",
      "categories": [
        "audit",
        "resources"
      ],
      "dataTypeId": "MICROSOFTAPP_APPENVSESSIONLIFECYCLELOGS",
      "artifactVersion": 2,
      "isResourceCentric": true,
      "tableState": "Production",
      "tags": {},
      "properties": {},
      "isLakeAllowed": true,
      "isTroubleshootingAllowed": true,
      "intelligencePacks": [
        "LogManagement"
      ],
      "input": [
        {
          "name": "time",
          "type": "DateTime"
        },
        {
          "name": "operationName",
          "type": "String"
        },
        {
          "name": "category",
          "type": "String"
        },
        {
          "name": "properties",
          "type": "Dynamic"
        },
        {
          "name": "location",
          "type": "String"
        }
      ],
      "transformFilePath": "KQL/AppEnvSessionLifecycleLogs.kql",
      "columns": [
        {
          "name": "TimeGenerated",
          "description": "Time (UTC) when the log was generated.",
          "type": "DateTime",
          "isDefaultDisplay": true
        },
        {
          "name": "OperationName",
          "description": "The name of the operation generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Location",
          "description": "The location of the Session Pool generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "SessionPoolName",
          "description": "The name of the Session Pool generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "PodName",
          "description": "The name of the session's pod generating this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "NodeName",
          "description": "The name of the node instance that generated this log.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Level",
          "description": "The log level of the log. This can be Info, Error, etc.",
          "type": "String",
          "isDefaultDisplay": true
        },
        {
          "name": "Log",
          "description": "The log generated by the Session Pool.",
          "type": "String",
          "isDefaultDisplay": true
        }
      ],
      "sampleInputRecordsFilePath": "SampleInputRecords/AppEnvSessionLifecycleLogs.json",
      "sampleOutputRecordsFilePath": "SampleOutputRecords/AppEnvSessionLifecycleLogs.json"
    }
  ],
  "functions": [],
  "queries": [
    {
      "id": "36891d32-455c-4492-9681-a06713a17de0",
      "displayName": "Latest Container App errors",
      "description": "Displays the 100 most recent logs written to the log stream in Azure Container Apps. This will help you quickly spot newly generated errors or warnings for troubleshooting.",
      "bodyFilePath": "KQL/LatestAppErrorsQuery.kql",
      "categories": ["resources"],
      "tags": {
        "Topic": ["Troubleshooting"]
      },
      "properties": { "ExampleQuery": true }
    },
    {
      "id": "191c185d-0bb0-4690-a8cd-51a38289b9c0",
      "displayName": "Most Frequent Error Messages",
      "description": "Retrieves the most common error messages by counting how often they appear, then returns the top 10.",
      "bodyFilePath": "KQL/MostFrequentErrorsQuery.kql",
      "categories": ["resources"],
      "tags": {
        "Topic": ["Troubleshooting"]
      },
      "properties": { "ExampleQuery": true }
    },
    {
      "id": "9db05ad5-c9f7-4136-882e-a5bebb798cf1",
      "displayName": "Failed Revision Provisions",
      "description": "Shows system logs indicating failures in provisioning revisions from the ContainerAppController, ordered by the most recent failures.",
      "bodyFilePath": "KQL/FailedRevisionProvisionsQuery.kql",
      "categories": ["resources"],
      "tags": {
        "Topic": ["Diagnostics"]
      },
      "properties": { "ExampleQuery": true }
    },
    {
      "id": "e5922e5d-6e1c-4bb8-a0ba-eb64414622a6",
      "displayName": "Probe Failed",
      "description": "Finds all probe failed logs.",
      "bodyFilePath": "KQL/ProbeFailedQuery.kql",
      "categories": ["resources"],
      "tags": {
        "Topic": ["Diagnostics"]
      },
      "properties": { "ExampleQuery": true }
    },
    {
      "id": "10b27cd1-2881-481a-aa4e-7a7b310fe3af",
      "displayName": "Error or Exception Logs Count",
      "description": "Provides a count of log messages with error or exception per environment, app, and revision in a table.",
      "bodyFilePath": "KQL/ErrorLogsCountQuery.kql",
      "categories": ["resources"],
      "tags": {
        "Topic": ["Troubleshooting"]
      },
      "properties": { "ExampleQuery": true }
    },
    {
      "id": "67abc9cc-f88e-4d0f-9b47-51bbff409682",
      "displayName": "Image Pull Failures",
      "description": "Provides logs that mention failures when pulling container images, which can indicate registry or network problems.",
      "bodyFilePath": "KQL/ImagePullFailuresQuery.kql",
      "categories": ["resources"],
      "tags": {
        "Topic": ["Troubleshooting"]
      },
      "properties": { "ExampleQuery": true }
    },
    {
      "id": "f94b4370-78dd-40ad-9b22-f3461f9d8446",
      "displayName": "Insufficient Quota",
      "description": "Provides logs that mention maximum allowed cores exceeded for the managed environment.",
      "bodyFilePath": "KQL/InsufficientQuotaQuery.kql",
      "categories": ["resources"],
      "tags": {
        "Topic": ["Troubleshooting"]
      },
      "properties": { "ExampleQuery": true }
    },
    {
      "id": "cbb070f5-c424-41ff-96ab-f3e6e31e18f2",
      "displayName": "Storage Mount Failed",
      "description": "Provides logs specifically related to storage mount failures.",
      "bodyFilePath": "KQL/StorageMountFailedQuery.kql",
      "categories": ["resources"],
      "tags": {
        "Topic": ["Troubleshooting"]
      },
      "properties": { "ExampleQuery": true }
    },
    {
      "id": "cf1dc664-075c-4fb6-962c-0280edb652a0",
      "displayName": "Pending infrastructure ready",
      "description": "Provides logs with replica pending for allocation due to infrastructure is not ready. It is usually caused by dedicate node is under scaling.",
      "bodyFilePath": "KQL/PendingInfrastructureReadyQuery.kql",
      "categories": ["resources"],
      "tags": {
        "Topic": ["Troubleshooting"]
      },
      "properties": { "ExampleQuery": true }
    }
  ]
}
