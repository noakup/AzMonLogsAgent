{
    "type": "Microsoft.Security/DefenderForStorageSettings",
    "displayName": "Defender for Storage Settings",
    "description": "This table contains malware scan results of azure storage blobs with detailed explanations on each blob scan like malware type or error information in case of failed scan.",
    "tags": {},
    "properties": {},
    "simplifiedSchemaVersion": "3",
    "icmTeam": "Microsoft Defender for Cloud/Antimalware for Storage",
    "contactDL": "storageaveng@microsoft.com",
    "relatedTables": [],
    "relatedFunctions": [],
    "tables": [
        {
            "workflowName": "StorageAntimalwareScanResultsWorkflow",
            "transformName": "StorageAntimalwareScanResults",
            "physicalName": "StorageMalwareScanningResults",
            "logicalName": "StorageMalwareScanningResults",
            "isChangeColumnInternalNameAllowed": true,
            "description": "Logs for malware scans performed by the Malware Scanning feature of Defender in Storage.",
            "categories": [
                "resources",
                "security"
            ],
            "tags": {},
            "properties": {},
            "artifactVersion": 5,
            "dataTypeId": "ANTIMALWARESETTINGS_SCANRESULTS",
            "intelligencePacks": [],
            "isResourceCentric": true,
            "tableState": "Production",
            "isLakeAllowed": true,
            "isTroubleshootingAllowed": true,
            "input": [
                {
                    "name": "time",
                    "type": "DateTime"
                },
                {
                    "name": "location",
                    "type": "String"
                },
                {
                    "name": "correlationId",
                    "type": "String"
                },
                {
                    "name": "resourceId",
                    "type": "String"
                },
                {
                    "name": "operationName",
                    "type": "String"
                },
                {
                    "name": "category",
                    "type": "String"
                },
                {
                    "name": "properties",
                    "type": "Dynamic"
                }
            ],
            "transformFilePath": "KQL/StorageAntimalwareScanResults.kql",
            "columns": [
                {
                    "name": "TimeGenerated",
                    "type": "DateTime",
                    "isDefaultDisplay": true,
                    "description": "The timestamp (UTC) when the log was generated."
                },
                {
                    "name": "CorrelationId",
                    "type": "String",
                    "isDefaultDisplay": true,
                    "description": "The ID of a specific scan.",
                    "dataTypeHint": "GUID"
                },
                {
                    "name": "OperationName",
                    "type": "String",
                    "isDefaultDisplay": true,
                    "description": "The operation associated with log record."
                },
                {
                    "name": "StorageAccountName",
                    "type": "String",
                    "isDefaultDisplay": true,
                    "description": "The name of the storage account."
                },
                {
                    "name": "StorageAccountLocation",
                    "type": "String",
                    "isDefaultDisplay": true,
                    "description": "The location of the storage account."
                },
                {
                    "name": "BlobUri",
                    "description": "The URI of the scanned blob.",
                    "type": "String",
                    "isDefaultDisplay": true,
                    "dataTypeHint": "URI"
                },
                {
                    "name": "BlobEtag",
                    "description": "The Etag of the scanned blob.",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "ScanFinishedTimeUtc",
                    "description": "Scan finished time in UTC.",
                    "type": "DateTime",
                    "isDefaultDisplay": true
                },
                {
                    "name": "ScanResultType",
                    "description": "Type of the scan result (Malicious, Error, No Threat Found, Not Scanned).",
                    "type": "String",
                    "isDefaultDisplay": true
                },
                {
                    "name": "ScanResultDetails",
                    "description": "Information regarding the scan results.",
                    "type": "Dynamic",
                    "isDefaultDisplay": true
                }
            ],
            "sampleInputRecordsFilePath": "SampleInputRecords/StorageAntimalwareShoeboxEventsSample.json",
            "sampleOutputRecordsFilePath": "SampleOutputRecords/StorageAntimalwareScanResultsSample.json"
        }
    ],
    "functions": [],
    "queries": [
    {
        "id": "30a46f4f-dc1a-43e1-9fe4-c82750e218b3",
        "displayName": "Malicious blobs per storage account",
        "description": "Blobs with malicious scan results group by storage account name.",
        "bodyFilePath": "KQL/MaliciousBlobsByStorageAccountQuery.kql",
        "categories": [
            "audit",
            "security"
        ],
        "tags": {},
        "properties": { "ExampleQuery": true },
        "relatedTables": [
            "StorageMalwareScanningResults"
        ]
    },
    {
        "id": "dd5cd0fc-683c-4ace-a7da-ef6afd649407",
        "displayName": "Unsuccessful Scans",
        "description": "Unsuccessful scans grouped by verdict and error information with related blob uris list, containing failed scans and encrypted blobs.",
        "bodyFilePath": "KQL/UnsuccessfulScansQuery.kql",
        "categories": [
            "audit",
            "security"
        ],
        "tags": {},
        "properties": { "ExampleQuery": true },
        "relatedTables": [
            "StorageMalwareScanningResults"
        ]
    }]
}