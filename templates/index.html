<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Natural Language KQL Agent</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .setup-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .setup-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-group input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .status-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            margin-left: 10px;
        }

        .status-connected {
            background: #d4edda;
            color: #155724;
        }

        .status-disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        .query-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .query-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .question-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1.1rem;
            margin-bottom: 15px;
            resize: vertical;
            min-height: 60px;
            transition: border-color 0.3s ease;
        }

        .question-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .suggestions {
            margin-bottom: 20px;
        }

        .suggestions h3 {
            color: #555;
            margin-bottom: 10px;
            font-size: 1rem;
            font-weight: 500;
        }

        .suggestion-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .suggestion-pill {
            background: #e9f4ff;
            color: #0066cc;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #b3d9ff;
        }

        .suggestion-pill:hover {
            background: #0066cc;
            color: white;
            transform: translateY(-1px);
        }

        .examples-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .example-btn {
            padding: 8px 15px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .example-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .example-btn.workspace-examples {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-weight: 500;
        }

        .example-btn.workspace-examples:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #654892 100%);
            transform: translateY(-1px);
        }

        .results-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            min-height: 100px;
            display: none;
        }

        .results-section.visible {
            display: block;
        }

        .results-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .result-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-steps {
            text-align: left;
            max-width: 400px;
            margin: 0 auto;
        }

        .current-step {
            font-size: 1.1rem;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .progress-steps {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .step {
            padding: 8px 12px;
            border-radius: 6px;
            background: #f8f9fa;
            color: #6c757d;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border-left: 3px solid #dee2e6;
        }

        .step.active {
            background: #e8f4fd;
            color: #0066cc;
            border-left-color: #667eea;
            transform: translateX(5px);
        }

        .step.completed {
            background: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }

        .step.retry {
            background: #fff3cd;
            color: #856404;
            border-left-color: #ffc107;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
            margin-top: 15px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            margin-top: 15px;
        }

        .timestamp {
            font-size: 0.8rem;
            color: #666;
            margin-top: 10px;
            text-align: right;
        }

        .progress-container {
            margin: 15px 0;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            height: 6px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .timing-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.8rem;
            color: #666;
        }

        .loading-stats {
            text-align: center;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #555;
        }

        /* Table styling for query results */
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .result-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .result-table td {
            padding: 10px 15px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .result-table tr:hover {
            background: #f8f9fa;
        }

        .result-table tr:last-child td {
            border-bottom: none;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0 10px 0;
            padding: 10px 0;
            border-bottom: 2px solid #e9ecef;
        }

        .table-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }

        .table-info {
            font-size: 0.9rem;
            color: #666;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .kql-query {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: #495057;
            white-space: pre-wrap;
        }

        .query-header {
            font-size: 0.9rem;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        .no-data-message {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }

        .result-container {
            max-height: 500px;
            overflow-y: auto;
            border-radius: 8px;
        }

        /* Enhanced responsive design for tables */
        @media (max-width: 768px) {
            .result-table {
                font-size: 0.8rem;
            }
            
            .result-table th,
            .result-table td {
                padding: 8px 10px;
            }
            
            .table-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .result-container {
                overflow-x: auto;
            }
        }

        /* Enhanced table features */
        .result-table tbody tr:nth-child(odd) {
            background-color: #f8f9fa;
        }

        .result-table tbody tr:nth-child(even) {
            background-color: white;
        }

        .cell-number {
            text-align: right;
            font-family: 'Courier New', monospace;
        }

        .cell-boolean {
            text-align: center;
            font-weight: 600;
        }

        .cell-boolean.true {
            color: #28a745;
        }

        .cell-boolean.false {
            color: #dc3545;
        }

        .cell-null {
            color: #6c757d;
            font-style: italic;
        }

        .table-stats {
            margin-top: 10px;
            padding: 8px 12px;
            background: #e9ecef;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #495057;
        }

        /* Explain button styling */
        .explain-section {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .btn-explain {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-explain:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .btn-explain:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .explain-loading {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #666;
            font-size: 0.9rem;
        }

        .explain-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .explain-result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #28a745;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .explain-result h4 {
            margin: 0 0 10px 0;
            color: #28a745;
            font-size: 1rem;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .main-content {
                padding: 20px;
            }

            .input-group {
                flex-direction: column;
            }

            .suggestion-pills,
            .examples-section {
                flex-direction: column;
            }
        }        /* Example suggestions styling */
        .example-suggestions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 15px 0;
        }

        .example-suggestion {
            background: #f8f9fa;
            color: #333;
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #dee2e6;
            text-align: left;
            font-weight: 500;
        }

        .example-suggestion:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }        /* Dedicated example suggestions section */
        .example-suggestions-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #667eea;
        }

        /* Explain Results Section */
        .explain-results-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #28a745;
        }        /* Workspace Discovery Results Styling */
        .workspace-discovery-results {
            max-width: 100%;
            overflow-x: auto;
        }
        
        .workspace-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .workspace-summary h4 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
        }
        
        .stat-label {
            display: block;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .stat-value {
            display: block;
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .example-categories {
            margin-bottom: 25px;
        }
        
        .example-categories h4 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .category-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .category-name {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }
        
        .category-count {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .tables-with-examples h4 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .tables-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .table-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .table-header h5 {
            color: #333;
            margin: 0;
            font-size: 1.1rem;
        }
        
        .record-count {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #495057;
        }
        
        .table-examples {
            margin-bottom: 15px;
        }
        
        .example-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 8px;
        }
        
        .example-source {
            font-weight: bold;
            color: #495057;
            font-size: 0.9rem;
        }
        
        .example-description {
            color: #6c757d;
            font-size: 0.8rem;
            margin-top: 3px;
        }
        
        .query-count {
            color: #007bff;
            font-size: 0.8rem;
            margin-top: 3px;
        }
        
        .table-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 6px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background 0.3s ease;
        }
        
        .btn-small:hover {
            background: #5a6fd8;
        }
        
        .quick-actions {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }
        
        .quick-actions h4 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .action-btn {
            padding: 10px 15px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }
        
        .action-btn:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 Natural Language KQL Agent</h1>
            <p>Ask questions about your Azure Log Analytics data in plain English</p>
        </div>

        <div class="main-content">
            <!-- Setup Section -->
            <div class="setup-section">
                <h2>🔧 Workspace Setup</h2>
                <div class="input-group">
                    <input type="text" id="workspaceId" placeholder="Enter your Log Analytics Workspace ID" value="">
                    <button class="btn btn-primary" onclick="setupWorkspace()">Connect</button>
                    <button class="btn btn-secondary" onclick="testConnection()">Test Connection</button>
                </div>
                <div id="setupStatus">
                    <span class="status-indicator status-disconnected">Not Connected</span>
                </div>
            </div>            <!-- Query Section -->
            <div class="query-section">
                <div class="suggestions">
                    <h3>💡 Quick Suggestions:</h3>
                    <div class="suggestion-pills">
                        <div class="suggestion-pill" onclick="setQuestion('Show me failed requests from the last hour')">Failed Requests</div>
                        <div class="suggestion-pill" onclick="setQuestion('What are the top 5 slowest API calls?')">Slowest APIs</div>
                        <div class="suggestion-pill" onclick="setQuestion('Show me recent exceptions')">Recent Exceptions</div>
                        <div class="suggestion-pill" onclick="setQuestion('Get heartbeat data from the last 30 minutes')">Heartbeat Data</div>
                        <div class="suggestion-pill" onclick="setQuestion('Show me dependency failures')">Dependency Failures</div>
                        <div class="suggestion-pill" onclick="setQuestion('What is the error rate in the last 24 hours?')">Error Rate</div>
                    </div>
                </div>                <div class="examples-section">
                    <h3>📚 See Examples:</h3>
                    <div class="example-btn" onclick="getExamples('requests')">Requests</div>
                    <div class="example-btn" onclick="getExamples('exceptions')">Exceptions</div>
                    <div class="example-btn" onclick="getExamples('traces')">Traces</div>
                    <div class="example-btn" onclick="getExamples('dependencies')">Dependencies</div>
                    <div class="example-btn" onclick="getExamples('performance')">Performance</div>
                    <div class="example-btn" onclick="getExamples('usage')">Usage</div>
                    <div class="example-btn workspace-examples" onclick="discoverWorkspaceExamples()">🔍 Workspace Examples</div>
                </div>

                <!-- Workspace Examples Section -->
                <div id="workspaceExamplesSection" class="results-section" style="display: none;">
                    <h3>🔍 Workspace Examples</h3>
                    <div id="workspaceExamplesContent" class="result-content">
                        <!-- Workspace examples will be populated here -->
                    </div>
                    <div id="workspaceTimestamp" class="timestamp"></div>
                </div>

                <!-- Example Suggestions Section -->
                <div id="exampleSuggestionsSection" class="example-suggestions-section">
                    <h3 id="exampleSuggestionsTitle">💡 Example Suggestions</h3>
                    <div id="exampleSuggestionsContent" class="example-suggestions-content">
                        <!-- Example suggestions will be populated here -->
                    </div>
                </div>

                <h2>💬 Ask Your Question</h2>
                <textarea 
                    id="questionInput" 
                    class="question-input" 
                    placeholder="Type your question here... (e.g., 'Show me failed requests from the last hour')"
                ></textarea>

                <div style="background: #e8f4fd; border: 1px solid #b3d9ff; border-radius: 8px; padding: 12px; margin-bottom: 15px; font-size: 0.9rem; color: #0066cc;">
                    <strong>🔄 Smart Translation:</strong> The system automatically retries translation if the first attempt fails, improving success rates for complex questions.
                </div>

                <button class="btn btn-success" onclick="enhancedAskQuestion()" style="width: 100%; margin-top: 15px;">
                    🚀 Ask Question
                </button>
            </div>            <!-- Results Section -->
            <div id="resultsSection" class="results-section">
                <h3>📊 Results</h3>
                <div id="resultContent" class="result-content"></div>
                <div id="timestamp" class="timestamp"></div>
            </div>

            <!-- Explain Results Section -->
            <div id="explainResultsSection" class="explain-results-section" style="display: none;">
                <div class="explain-section">
                    <button class="btn-explain" onclick="explainResults()" id="explainBtn">
                        🧠 Explain Results
                    </button>
                    <div id="explainContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isConnected = false;
        let currentQueryResult = null; // Store current query result for explain feature
        let currentOriginalQuestion = '';

        function updateStatus(connected, message = '') {
            isConnected = connected;
            const statusElement = document.getElementById('setupStatus');
            
            if (connected) {
                statusElement.innerHTML = `<span class="status-indicator status-connected">✅ Connected</span>`;
                if (message) {
                    statusElement.innerHTML += `<div class="success">${message}</div>`;
                }
            } else {
                statusElement.innerHTML = `<span class="status-indicator status-disconnected">❌ Not Connected</span>`;
                if (message) {
                    statusElement.innerHTML += `<div class="error">${message}</div>`;
                }
            }
        }
        
        function showLoading(step = 'Initializing...') {
            const resultsSection = document.getElementById('resultsSection');
            const resultContent = document.getElementById('resultContent');
            
            resultsSection.classList.add('visible');
            resultContent.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div class="loading-steps">
                        <div id="currentStep" class="current-step">${step}</div>
                        
                        <div class="progress-container">
                            <div id="progressBar" class="progress-bar"></div>
                        </div>
                        
                        <div class="timing-info">
                            <span id="progressPercent">0%</span>
                            <span id="estimatedTime">Estimating...</span>
                        </div>
                        
                        <div class="progress-steps">
                            <div class="step" id="step-translate">🔄 Translating to KQL...</div>
                            <div class="step" id="step-validate">✅ Validating query...</div>
                            <div class="step" id="step-execute">⚡ Executing query...</div>
                            <div class="step" id="step-format">📊 Formatting results...</div>
                        </div>
                        
                        <div class="loading-stats">
                            <div>✨ <strong>Smart Retry Logic:</strong> Automatic retries for better results</div>
                            <div>🕐 <strong>Timespan Detection:</strong> Intelligent time filter handling</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Hide explain section during loading
            hideExplainSection();
        }

        // Analytics and metrics for enhanced loading
        let loadingMetrics = {
            startTime: null,
            retryCount: 0,
            totalSteps: 4,
            currentStep: 0,
            estimatedDuration: 8000 // 8 seconds baseline
        };

        function initializeMetrics() {
            loadingMetrics.startTime = Date.now();
            loadingMetrics.retryCount = 0;
            loadingMetrics.currentStep = 0;
        }

        function trackRetry() {
            loadingMetrics.retryCount++;
            // Adjust estimated duration based on retries
            loadingMetrics.estimatedDuration += 2000; // Add 2s per retry
        }

        function calculateProgress(phase) {
            const phaseProgress = {
                'translate': 25,
                'validate': 60, 
                'execute': 80,
                'format': 95,
                'complete': 100
            };
            
            let baseProgress = phaseProgress[phase] || 0;
            
            // Adjust for retries
            if (loadingMetrics.retryCount > 0) {
                baseProgress = Math.max(15, baseProgress - (loadingMetrics.retryCount * 5));
            }
            
            return Math.min(100, baseProgress);
        }

        function getSmartEstimate() {
            const elapsed = Date.now() - loadingMetrics.startTime;
            const remaining = Math.max(0, loadingMetrics.estimatedDuration - elapsed);
            return Math.ceil(remaining / 1000);
        }

        function updateProgress(percentage, stepName = '') {
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            const currentStep = document.getElementById('currentStep');
            
            if (progressBar) {
                progressBar.style.width = `${percentage}%`;
            }
            
            if (progressPercent) {
                progressPercent.textContent = `${percentage}%`;
            }
            
            if (stepName && currentStep) {
                currentStep.textContent = stepName;
            }
        }

        function updateEstimatedTime(seconds) {
            const estimatedTime = document.getElementById('estimatedTime');
            if (estimatedTime) {
                if (seconds > 0) {
                    estimatedTime.textContent = `~${seconds}s remaining`;
                } else {
                    estimatedTime.textContent = 'Almost done...';
                }
            }
        }

        function updateLoadingStep(stepId, status = 'active') {
            const stepElement = document.getElementById(stepId);
            const currentStepElement = document.getElementById('currentStep');
            
            if (stepElement) {
                // Remove previous status classes
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.remove('active', 'completed', 'retry');
                });
                
                // Update current step
                stepElement.classList.add(status);
                
                // Update current step text
                const stepTexts = {
                    'step-translate': '🔄 Translating your question to KQL...',
                    'step-validate': '✅ Validating generated query...',
                    'step-execute': '⚡ Executing query on Azure Log Analytics...',
                    'step-format': '📊 Formatting results for display...'
                };
                
                if (currentStepElement && stepTexts[stepId]) {
                    currentStepElement.textContent = stepTexts[stepId];
                    
                    // Add retry indication if needed
                    if (status === 'retry') {
                        currentStepElement.textContent += ' (retrying for better results...)';
                    }
                }
            }
        }
        
        function showResult(result, timestamp) {
            const resultContent = document.getElementById('resultContent');
            const timestampElement = document.getElementById('timestamp');
            
            // Store current result for explain feature
            currentQueryResult = result;
              // Handle both old text format and new structured format
            if (typeof result === 'string') {
                // Legacy text format
                resultContent.innerHTML = `<pre style="white-space: pre-wrap; font-family: 'Courier New', monospace;">${result}</pre>`;
                // Hide explain section for legacy format
                hideExplainSection();
            } else if (result && typeof result === 'object') {
                // New structured format
                let html = '';
                
                if (result.type === 'query_success') {
                    // Show the generated KQL query
                    html += `<div class="query-header">📝 Generated KQL Query:</div>`;
                    html += `<div class="kql-query">${result.kql_query}</div>`;
                    
                    // Show the data tables
                    if (result.data && result.data.type === 'table_data') {
                        const tables = result.data.tables;
                          if (tables && tables.length > 0) {
                            tables.forEach(table => {
                                html += createTableHTML(table);
                            });
                            
                            // Show explain section for successful queries with data
                            showExplainSection();                        } else {
                            html += `<div class="no-data-message">No data returned from query</div>`;
                            // Hide explain section for no data
                            hideExplainSection();
                        }                    } else if (result.data && result.data.type === 'no_data') {
                        html += `<div class="no-data-message">${result.data.message}</div>`;
                        // Hide explain section for no data
                        hideExplainSection();
                    }
                } else if (result.type === 'query_error') {
                    html += `<div class="query-header">📝 Generated KQL Query:</div>`;
                    html += `<div class="kql-query">${result.kql_query}</div>`;
                    html += `<div class="error">❌ Error: ${result.error}</div>`;
                    // Hide explain section for errors
                    hideExplainSection();
                } else {
                    // Fallback for other structured data
                    html += `<pre style="white-space: pre-wrap;">${JSON.stringify(result, null, 2)}</pre>`;
                    // Hide explain section for unknown formats
                    hideExplainSection();
                }
                
                resultContent.innerHTML = html;
            } else {
                // Fallback for unexpected formats
                resultContent.innerHTML = `<pre style="white-space: pre-wrap;">${String(result)}</pre>`;
                // Hide explain section for unexpected formats
                hideExplainSection();
            }
            
            timestampElement.textContent = `Response received at: ${timestamp}`;
        }

        function createTableHTML(table) {
            let html = '';
            
            // Table header with info
            html += `<div class="table-header">`;
            html += `<div class="table-title">📊 Table ${table.table_number}</div>`;
            html += `<div class="table-info">${table.row_count} rows</div>`;
            html += `</div>`;
            
            if (table.has_data && table.columns && table.rows) {
                html += `<div class="result-container">`;
                html += `<table class="result-table">`;
                
                // Table header
                html += `<thead><tr>`;
                table.columns.forEach(column => {
                    html += `<th>${escapeHtml(column)}</th>`;
                });
                html += `</tr></thead>`;
                  // Table body
                html += `<tbody>`;
                table.rows.forEach(row => {
                    html += `<tr>`;
                    row.forEach((cell, index) => {
                        const cellValue = cell === null || cell === undefined ? 'NULL' : String(cell);
                        const cellClass = getCellClass(cell);
                        html += `<td class="${cellClass}">${escapeHtml(cellValue)}</td>`;
                    });
                    html += `</tr>`;
                });
                html += `</tbody>`;
                  html += `</table>`;
                html += `</div>`;
                
                // Add table statistics
                if (table.has_data) {
                    html += `<div class="table-stats">`;
                    html += `📊 ${table.columns.length} columns • ${table.row_count} rows`;
                    if (table.row_count !== table.rows.length) {
                        html += ` • Showing ${table.rows.length} of ${table.row_count}`;
                    }
                    html += `</div>`;
                }
            } else {
                html += `<div class="no-data-message">No data in this table</div>`;
            }
            
            return html;
        }
        
        function createExplainSection() {
            return `
                <div class="explain-section">
                    <button class="btn-explain" onclick="explainResults()" id="explainBtn">
                        🧠 Explain Results
                    </button>
                    <div id="explainContent"></div>
                </div>
            `;
        }

        function showExplainSection() {
            const explainSection = document.getElementById('explainResultsSection');
            const explainContent = document.getElementById('explainContent');
            
            // Clear any previous content
            explainContent.innerHTML = '';
            
            // Show the explain section
            explainSection.style.display = 'block';
        }

        function hideExplainSection() {
            const explainSection = document.getElementById('explainResultsSection');
            if (explainSection) {
                explainSection.style.display = 'none';
            }
        }

        async function explainResults() {
            const explainBtn = document.getElementById('explainBtn');
            const explainContent = document.getElementById('explainContent');
            
            // Check if we have current results to explain
            if (!currentQueryResult || currentQueryResult.type !== 'query_success') {
                explainContent.innerHTML = `<div class="explain-result"><h4>❌ No Results to Explain</h4><p>Please run a successful query first.</p></div>`;
                return;
            }
            
            // Disable button and show loading
            explainBtn.disabled = true;
            explainContent.innerHTML = `
                <div class="explain-loading">
                    <div class="explain-spinner"></div>
                    Analyzing query results with AI...
                </div>
            `;
            
            try {
                // Make API call to explain endpoint
                const response = await fetch('/api/explain', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query_result: currentQueryResult,
                        original_question: currentOriginalQuestion
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    explainContent.innerHTML = `
                        <div class="explain-result">
                            <h4>🧠 AI Analysis</h4>
                            <p>${data.explanation.replace(/\n/g, '<br>')}</p>
                            <small style="color: #666;">Analysis generated at: ${data.timestamp}</small>
                        </div>
                    `;
                } else {
                    explainContent.innerHTML = `
                        <div class="explain-result">
                            <h4>❌ Explanation Failed</h4>
                            <p>${data.error}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                explainContent.innerHTML = `
                    <div class="explain-result">
                        <h4>❌ Error</h4>
                        <p>Failed to explain results: ${error.message}</p>
                    </div>
                `;
            } finally {
                // Re-enable the button
                explainBtn.disabled = false;
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function showError(error) {
            const resultContent = document.getElementById('resultContent');
            const timestampElement = document.getElementById('timestamp');
            
            resultContent.innerHTML = `<div class="error">❌ Error: ${error}</div>`;
            timestampElement.textContent = `Error occurred at: ${new Date().toLocaleString()}`;
            
            // Hide explain section when showing errors
            hideExplainSection();
        }

        async function setupWorkspace() {
            const workspaceId = document.getElementById('workspaceId').value.trim();
            
            if (!workspaceId) {
                updateStatus(false, 'Please enter a workspace ID');
                return;
            }

            try {
                const response = await fetch('/api/setup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ workspace_id: workspaceId })
                });

                const data = await response.json();
                
                if (data.success) {
                    updateStatus(true, data.message);
                } else {
                    updateStatus(false, data.error);
                }
            } catch (error) {
                updateStatus(false, `Connection failed: ${error.message}`);
            }
        }

        async function testConnection() {
            if (!isConnected) {
                updateStatus(false, 'Please setup workspace first');
                return;
            }

            showLoading();

            try {
                const response = await fetch('/api/test-connection', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();
                
                if (data.success) {
                    showResult(data.result, data.timestamp);
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError(`Connection test failed: ${error.message}`);
            }
        }
        
        async function askQuestion() {
            const question = document.getElementById('questionInput').value.trim();
            
            if (!question) {
                showError('Please enter a question');
                return;
            }

            if (!isConnected) {
                showError('Please setup workspace first');
                return;
            }

            // Show initial loading
            showLoading('🚀 Starting query process...');
            
            // Simulate progress steps
            setTimeout(() => updateLoadingStep('step-translate', 'active'), 200);
            
            try {
                const response = await fetch('/api/query', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: question })
                });

                // Show validation step
                updateLoadingStep('step-translate', 'completed');
                updateLoadingStep('step-validate', 'active');
                
                const data = await response.json();
                
                // Show execution step
                updateLoadingStep('step-validate', 'completed');
                updateLoadingStep('step-execute', 'active');
                
                // Small delay to show execution step
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Show formatting step
                updateLoadingStep('step-execute', 'completed');
                updateLoadingStep('step-format', 'active');
                
                // Small delay to show formatting step
                await new Promise(resolve => setTimeout(resolve, 300));
                
                if (data.success) {
                    updateLoadingStep('step-format', 'completed');
                    showResult(data.result, data.timestamp);
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError(`Query failed: ${error.message}`);
            }
        }

        function simulateRetry() {
            // Show retry indication
            updateLoadingStep('step-translate', 'retry');
            
            setTimeout(() => {
                updateLoadingStep('step-translate', 'completed');
                updateLoadingStep('step-validate', 'active');
            }, 1500);
        }        function enhancedAskQuestion() {
            const question = document.getElementById('questionInput').value.trim();
            
            if (!question) {
                showError('Please enter a question');
                return;
            }

            if (!isConnected) {
                showError('Please setup workspace first');
                return;
            }

            // Store the original question for explain feature
            currentOriginalQuestion = question;

            // Show initial loading
            showLoading('🚀 Preparing to process your question...');
            
            // Start with translation step
            setTimeout(() => {
                updateLoadingStep('step-translate', 'active');
                processQuestionWithRetry(question);
            }, 300);
        }async function processQuestionWithRetry(question) {
            let retryCount = 0;
            const maxRetries = 2;
            const startTime = Date.now();
            
            // Initialize progress
            updateProgress(10, '🔄 Starting translation process...');
            updateEstimatedTime(8);
            
            while (retryCount <= maxRetries) {
                try {
                    if (retryCount > 0) {
                        // Show retry indication
                        updateProgress(15 + (retryCount * 5), `🔄 Retry attempt ${retryCount}...`);
                        updateLoadingStep('step-translate', 'retry');
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                    
                    // Translation phase
                    updateProgress(25, '🔄 Translating to KQL...');
                    updateLoadingStep('step-translate', 'active');
                    updateEstimatedTime(6);
                    
                    // Simulate translation time
                    await new Promise(resolve => setTimeout(resolve, 800 + (retryCount * 500)));
                    
                    // Make the actual API call
                    updateProgress(40, '📡 Sending request to server...');
                    const response = await fetch('/api/query', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ question: question })
                    });

                    // Validation phase
                    updateProgress(60, '✅ Validating generated query...');
                    updateLoadingStep('step-translate', 'completed');
                    updateLoadingStep('step-validate', 'active');
                    updateEstimatedTime(4);
                    await new Promise(resolve => setTimeout(resolve, 400));
                    
                    const data = await response.json();
                    
                    // Check if we need to retry (simulate retry logic)
                    if (!data.success && retryCount < maxRetries && data.error.includes('translation')) {
                        retryCount++;
                        updateLoadingStep('step-validate', 'retry');
                        continue;
                    }
                    
                    // Execution phase
                    updateProgress(80, '⚡ Executing query on Azure...');
                    updateLoadingStep('step-validate', 'completed');
                    updateLoadingStep('step-execute', 'active');
                    updateEstimatedTime(2);
                    await new Promise(resolve => setTimeout(resolve, 600));
                    
                    // Formatting phase
                    updateProgress(95, '📊 Formatting results...');
                    updateLoadingStep('step-execute', 'completed');
                    updateLoadingStep('step-format', 'active');
                    updateEstimatedTime(1);
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    // Complete
                    updateProgress(100, '✅ Complete!');
                    updateEstimatedTime(0);
                    
                    if (data.success) {
                        updateLoadingStep('step-format', 'completed');
                        const totalTime = ((Date.now() - startTime) / 1000).toFixed(1);
                        
                        // Show completion with stats
                        setTimeout(() => {
                            showResult(data.result, data.timestamp);
                        }, 500);
                    } else {
                        showError(data.error);
                    }
                    break;
                    
                } catch (error) {
                    if (retryCount < maxRetries) {
                        retryCount++;
                        updateProgress(20 + (retryCount * 5), `🔄 Retrying... (${retryCount}/${maxRetries})`);
                        updateLoadingStep('step-translate', 'retry');
                        continue;
                    } else {
                        showError(`Query failed after ${maxRetries + 1} attempts: ${error.message}`);
                        break;
                    }
                }
            }
        }        async function getExamples(scenario) {
            if (!isConnected) {
                showError('Please setup workspace first');
                return;
            }

            // Show loading in the dedicated section
            showExampleSuggestionsLoading(scenario);

            try {
                const response = await fetch(`/api/examples/${scenario}`);
                const data = await response.json();
                
                if (data.success) {
                    showExampleSuggestions(data.result);
                } else {
                    showExampleSuggestionsError(data.error);
                }
            } catch (error) {
                showExampleSuggestionsError(`Failed to get examples: ${error.message}`);
            }
        }

        function showExampleSuggestionsLoading(scenario) {
            const section = document.getElementById('exampleSuggestionsSection');
            const title = document.getElementById('exampleSuggestionsTitle');
            const content = document.getElementById('exampleSuggestionsContent');
            
            title.textContent = `💫 Loading ${scenario.charAt(0).toUpperCase() + scenario.slice(1)} Examples...`;
            content.innerHTML = `
                <div style="text-align: center; padding: 20px; color: #666;">
                    <div class="spinner" style="margin: 0 auto 10px;"></div>
                    Loading example suggestions...
                </div>
            `;
            section.style.display = 'block';
        }

        function showExampleSuggestions(result) {
            console.log('showExampleSuggestions called with:', result);
            
            if (result.type === 'example_suggestions') {
                console.log('Showing example suggestions for scenario:', result.scenario);
                
                const section = document.getElementById('exampleSuggestionsSection');
                const title = document.getElementById('exampleSuggestionsTitle');
                const content = document.getElementById('exampleSuggestionsContent');
                
                console.log('DOM elements found:', { section, title, content });
                
                title.textContent = `💡 ${result.scenario.charAt(0).toUpperCase() + result.scenario.slice(1)} Examples`;
                
                let html = '';
                result.suggestions.forEach((suggestion, index) => {
                    html += `<div class="example-suggestion" data-suggestion="${index}">${escapeHtml(suggestion)}</div>`;
                });
                html += `<div style="margin-top: 15px; font-size: 0.9rem; color: #666; text-align: center;">💡 Click any suggestion above to add it to your question box</div>`;
                
                console.log('Generated HTML:', html);
                
                content.innerHTML = html;
                
                // Store suggestions for click handling
                content.dataset.suggestions = JSON.stringify(result.suggestions);
                
                // Add click event listeners to suggestion elements
                content.querySelectorAll('.example-suggestion').forEach((element, index) => {
                    element.addEventListener('click', () => {
                        const suggestion = result.suggestions[index];
                        console.log('Suggestion clicked:', suggestion);
                        setQuestion(suggestion);
                    });
                });
                section.style.display = 'block';
                
                console.log('Example suggestions section should now be visible');
            } else {
                console.log('Result type is not example_suggestions:', result.type);
            }
        }

        function showExampleSuggestionsError(error) {
            const section = document.getElementById('exampleSuggestionsSection');
            const title = document.getElementById('exampleSuggestionsTitle');
            const content = document.getElementById('exampleSuggestionsContent');
            
            title.textContent = '❌ Error Loading Examples';
            content.innerHTML = `
                <div style="text-align: center; padding: 20px; color: #dc3545;">
                    ${error}
                </div>
            `;
            section.style.display = 'block';
        }

        function setQuestion(question) {
            document.getElementById('questionInput').value = question;
        }

        async function discoverWorkspaceExamples() {
            console.log('🔍 Workspace Examples button clicked');
            console.log('isConnected:', isConnected);
            
            // Allow workspace examples discovery even without connection
            // since we're just showing available example files
            
            try {
                console.log('📡 Starting workspace discovery...');
                showLoading('Discovering workspace tables and available examples...');
                
                console.log('📡 Making fetch request to /api/workspace-examples');
                const response = await fetch('/api/workspace-examples', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('📡 Response received:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('📊 Response data:', data);
                
                if (data.success) {
                    console.log('✅ Success, showing workspace examples');
                    console.log('Available examples:', Object.keys(data.available_examples));
                    showWorkspaceExamples(data);
                } else {
                    console.log('❌ API error:', data.error);
                    showError(`Failed to discover examples: ${data.error}`);
                }
            } catch (error) {
                console.error('💥 Network error:', error);
                console.error('Error stack:', error.stack);
                showError(`Network error: ${error.message}`);
            }
        }

        function showWorkspaceExamples(data) {
            console.log('📊 showWorkspaceExamples called with data:', data);
            
            try {
                // First, ensure the main results section is hidden
                const resultsSection = document.getElementById('resultsSection');
                console.log('🔍 Found resultsSection:', resultsSection);
                if (resultsSection) {
                    resultsSection.classList.remove('visible');
                    resultsSection.style.display = 'none'; // Force hide
                }
                
                const workspaceSection = document.getElementById('workspaceExamplesSection');
                const workspaceContent = document.getElementById('workspaceExamplesContent');
                const workspaceTimestamp = document.getElementById('workspaceTimestamp');
                
                console.log('🔍 Found workspace elements:', { workspaceSection, workspaceContent, workspaceTimestamp });
                
                if (!workspaceSection || !workspaceContent || !workspaceTimestamp) {
                    throw new Error('Required workspace DOM elements not found');
                }
                
                console.log('📝 Building HTML content...');
            
            // Create simplified display with only tables
            let html = `
                <div class="workspace-discovery-results">
                    <div class="tables-with-examples">
                        <h4>📊 Tables with Available Examples</h4>
                        <div class="tables-grid">
            `;
            
            for (const [tableName, tableData] of Object.entries(data.available_examples)) {
                html += `
                    <div class="table-card">
                        <div class="table-header">
                            <h5>${tableName}</h5>
                            <span class="record-count">${tableData.table_info.record_count.toLocaleString()} records</span>
                        </div>
                        <div class="table-examples">
                `;
                
                tableData.examples.forEach(example => {
                    html += `
                        <div class="example-item">
                            <div class="example-source">${example.source}</div>
                            <div class="example-description">${example.description}</div>
                            ${example.query_count ? `<div class="query-count">${example.query_count} queries</div>` : ''}
                        </div>
                    `;
                });
                
                html += `
                        </div>
                        <div class="table-actions">
                            <button class="btn-small" onclick="getExamplesForTable('${tableName}')">Get Examples</button>
                            <button class="btn-small" onclick="setQuestion('Show me recent data from ${tableName}')">View Data</button>
                        </div>
                    </div>
                `;
            }
            
            html += `
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <h4>🚀 Quick Actions</h4>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="setQuestion('What example queries do you have for the tables in this workspace?')">Ask About Examples</button>
                            <button class="action-btn" onclick="setQuestion('Show me all tables in this workspace')">List All Tables</button>
                            <button class="action-btn" onclick="setQuestion('Which tables have the most data?')">Top Tables by Volume</button>
                        </div>
                    </div>
                </div>
            `;
            
            workspaceContent.innerHTML = html;
            workspaceTimestamp.textContent = `Last updated: ${data.timestamp}`;
            
            // Force the workspace section to be visible
            workspaceSection.style.display = 'block';
            workspaceSection.classList.add('visible');
            
            console.log('✅ Workspace examples displayed, section visibility:', workspaceSection.style.display);
            console.log('✅ Workspace section classes:', workspaceSection.className);
            
            // Scroll to workspace examples section
            setTimeout(() => {
                workspaceSection.scrollIntoView({ behavior: 'smooth' });
                console.log('📍 Scrolled to workspace section');
            }, 100);
            
            } catch (error) {
                console.error('💥 Error in showWorkspaceExamples:', error);
                showError(`Failed to display workspace examples: ${error.message}`);
            }
        }

        function hideLoading() {
            // This function isn't needed since showResult and showError handle hiding the loading state
            // But we'll keep it for consistency with existing calls
        }

        function getCellClass(cell) {
            if (cell === null || cell === undefined) {
                return 'cell-null';
            }
            if (typeof cell === 'number') {
                return 'cell-number';
            }
            if (typeof cell === 'boolean') {
                return `cell-boolean ${cell ? 'true' : 'false'}`;
            }
            return '';
        }

        function getExamplesForTable(tableName) {
            // Map table names to scenario names
            const tableToScenarioMap = {
                'AppRequests': 'requests',
                'AppExceptions': 'exceptions', 
                'AppTraces': 'traces',
                'AppDependencies': 'dependencies',
                'AppPageViews': 'page_views',
                'AppCustomEvents': 'custom_events',
                'AppPerformanceCounters': 'performance',
                'Usage': 'usage'
            };
            
            const scenario = tableToScenarioMap[tableName];
            if (scenario) {
                getExamples(scenario);
                
                // Scroll to the example suggestions section after a short delay
                setTimeout(() => {
                    const exampleSuggestionsSection = document.getElementById('exampleSuggestionsSection');
                    if (exampleSuggestionsSection) {
                        exampleSuggestionsSection.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'start' 
                        });
                    }
                }, 500); // Small delay to ensure the examples are loaded first
            } else {
                showError(`No examples available for table: ${tableName}`);
            }
        }
    </script>
</body>
</html>
